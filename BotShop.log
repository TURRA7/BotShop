2024-10-31 09:39:38,325 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:39:41,855 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:39:52,713 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:39:53,039 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:40:32,466 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:40:32,775 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:40:52,008 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:40:52,539 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:42:39,878 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:42:40,467 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:43:48,765 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:43:49,080 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:43:49,080 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:43:49,141 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:43:49,221 - aiogram.event - feed_update - INFO - Update id=874833168 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:43:49,221 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833168 by bot id=7942268445
TypeError: object Select can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await select(User).where(User.tg_id == user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Select can't be used in 'await' expression
2024-10-31 09:43:52,125 - aiogram.event - feed_update - INFO - Update id=874833169 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:43:52,125 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833169 by bot id=7942268445
TypeError: object Select can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await select(User).where(User.tg_id == user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Select can't be used in 'await' expression
2024-10-31 09:43:54,480 - aiogram.event - feed_update - INFO - Update id=874833170 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:43:54,480 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833170 by bot id=7942268445
TypeError: object Select can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await select(User).where(User.tg_id == user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Select can't be used in 'await' expression
2024-10-31 09:45:18,236 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:45:18,236 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:45:18,236 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:45:18,457 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:45:27,286 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:45:27,761 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:45:27,761 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:45:27,828 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:45:30,982 - aiogram.event - feed_update - INFO - Update id=874833171 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:45:30,982 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833171 by bot id=7942268445
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    user = await session.execute(result).scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
2024-10-31 09:45:33,497 - aiogram.event - feed_update - INFO - Update id=874833172 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:45:33,497 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833172 by bot id=7942268445
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    user = await session.execute(result).scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
2024-10-31 09:48:21,370 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:48:21,370 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:48:21,370 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:48:21,644 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:48:28,653 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:48:29,031 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:48:29,031 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:48:29,099 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:48:30,494 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:48:30,494 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:48:30,496 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:48:30,496 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:48:30,497 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:48:30,497 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:48:30,497 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:48:30,500 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:48:30,500 - aiogram.event - feed_update - INFO - Update id=874833173 is not handled. Duration 54 ms by bot id=7942268445
2024-10-31 09:48:30,500 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833173 by bot id=7942268445
NoReferencedColumnError: Could not initialize target column for ForeignKey 'users.id' on table 'shopping_cart': table 'users' has no column named 'id'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    users = await session.execute(result)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1644, in do_init
    self._setup_join_conditions()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1884, in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
                                ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2310, in __init__
    self._determine_joins()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2423, in _determine_joins
    self.primaryjoin = join_condition(
                       ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/util.py", line 123, in join_condition
    return Join._join_condition(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py", line 1363, in _join_condition
    constraints = cls._joincond_scan_left_right(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py", line 1451, in _joincond_scan_left_right
    col = fk.get_referent(left)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3033, in get_referent
    return table.columns.corresponding_column(self.column)  # type: ignore
                                              ^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1141, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3170, in column
    return self._resolve_column()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3209, in _resolve_column
    return self._link_to_col_by_colstring(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3131, in _link_to_col_by_colstring
    raise exc.NoReferencedColumnError(
sqlalchemy.exc.NoReferencedColumnError: Could not initialize target column for ForeignKey 'users.id' on table 'shopping_cart': table 'users' has no column named 'id'
2024-10-31 09:50:50,472 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:50:50,473 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:50:50,473 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:50:50,706 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:50:59,426 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:50:59,475 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:50:59,475 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:50:59,476 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:50:59,476 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:50:59,477 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:50:59,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:50:59,478 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:50:59,480 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,480 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,489 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,490 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.009678s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,490 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,490 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01038s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,491 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,491 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01118s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,492 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,492 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01185s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,492 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,493 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01259s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,493 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:50:59,494 - __main__ - start - DEBUG - Ошибка приложения Foreign key associated with column 'users.referred_by' could not find table 'user' with which to generate a foreign key to target column 'id'
2024-10-31 09:52:10,645 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:52:10,696 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:52:10,696 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:52:10,697 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:52:10,697 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:52:10,698 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:52:10,698 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:52:10,698 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:52:10,701 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,701 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,702 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,702 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0017s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002111s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002505s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002891s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003264s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:52:10,705 - __main__ - start - DEBUG - Ошибка приложения Foreign key associated with column 'users.referred_by' could not find table 'user' with which to generate a foreign key to target column 'id'
2024-10-31 09:53:48,834 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:53:48,883 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:53:48,883 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:53:48,885 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:53:48,887 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,887 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,889 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,889 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001866s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002323s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002699s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00307s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,891 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,891 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003458s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,891 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:53:48,891 - __main__ - start - DEBUG - Ошибка приложения Could not initialize target column for ForeignKey 'users.id' on table 'users': table 'users' has no column named 'id'
2024-10-31 09:54:10,126 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:54:10,175 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:54:10,175 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:54:10,176 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:54:10,176 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:54:10,177 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:54:10,177 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:54:10,177 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:54:10,180 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,180 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,181 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001902s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002319s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002721s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003119s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003507s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,184 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 09:54:10,184 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:54:10,202 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 09:54:10,202 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00011s] ()
2024-10-31 09:54:10,206 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 09:54:10,206 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 09:54:10,210 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 09:54:10,210 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 09:54:10,214 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 09:54:10,214 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:54:10,216 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 09:54:10,216 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 09:54:10,220 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 09:54:10,532 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:54:10,532 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:54:10,591 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:54:14,127 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:54:14,133 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:54:14,133 - aiogram.event - feed_update - INFO - Update id=874833174 is not handled. Duration 6 ms by bot id=7942268445
2024-10-31 09:54:14,133 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833174 by bot id=7942268445
InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'Order_item'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    users = await session.execute(result)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1854, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
2024-10-31 09:58:06,038 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:58:06,039 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:58:06,039 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:58:06,229 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:59:46,145 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:59:46,194 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:59:46,194 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:59:46,196 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:59:46,198 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,198 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,199 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001585s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001996s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002386s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002773s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003149s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,202 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 09:59:46,202 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,203 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 09:59:46,203 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 09:59:46,204 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 09:59:46,204 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,205 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 09:59:46,205 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,206 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 09:59:46,206 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,207 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 09:59:46,593 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:59:46,593 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:59:46,660 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:59:48,145 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:59:48,146 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:59:48,146 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:59:48,407 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:00:11,558 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:00:11,608 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:00:11,608 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:00:11,609 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:00:11,609 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:00:11,610 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:00:11,610 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:00:11,610 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:00:11,613 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,613 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,614 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,614 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001676s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002152s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002667s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003019s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003369s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,617 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:00:11,617 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,623 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:00:11,623 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00013s] ()
2024-10-31 10:00:11,627 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:00:11,627 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,630 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:00:11,630 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,633 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:00:11,634 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:00:11,635 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:00:11,636 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,638 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:00:12,164 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:00:12,164 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:00:12,233 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:00:14,725 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:00:14,730 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:00:14,730 - aiogram.event - feed_update - INFO - Update id=874833175 is not handled. Duration 5 ms by bot id=7942268445
2024-10-31 10:00:14,730 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833175 by bot id=7942268445
InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'Order_item'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1854, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
2024-10-31 10:03:02,530 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:03:02,531 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:02,531 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:03:02,779 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:03:15,589 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:03:15,639 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:03:15,639 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:15,640 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:03:15,640 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:15,641 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:03:15,641 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:15,641 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:03:15,644 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,644 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,645 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,645 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001574s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001998s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002402s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003141s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003528s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,648 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:03:15,648 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:03:15,649 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:03:15,649 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:03:15,650 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:03:15,650 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:03:15,652 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:03:15,652 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:03:15,653 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:03:16,059 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:03:16,059 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:03:16,125 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:16,287 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:03:16,287 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:16,288 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:03:16,503 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:03:24,318 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:03:24,368 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:03:24,369 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:24,371 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:03:24,373 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,373 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001761s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002254s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002684s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003081s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003463s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:03:24,385 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:03:24,385 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00013s] ()
2024-10-31 10:03:24,389 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:03:24,389 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00011s] ()
2024-10-31 10:03:24,392 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:03:24,392 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:03:24,397 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:03:24,397 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:03:24,399 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:03:24,399 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:03:24,402 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:03:24,726 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:03:24,726 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:03:24,812 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:25,610 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:03:25,615 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:03:25,615 - aiogram.event - feed_update - INFO - Update id=874833176 is not handled. Duration 5 ms by bot id=7942268445
2024-10-31 10:03:25,615 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833176 by bot id=7942268445
InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'Order_item'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1854, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
2024-10-31 10:05:50,170 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:05:50,171 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:05:50,171 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:05:50,389 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:06:05,938 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:06:05,989 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:06:05,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:05,991 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:06:05,993 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,993 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002785s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003254s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00366s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.004048s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.004489s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,998 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:06:05,998 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:06:05,999 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:06:06,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:06:06,000 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:06:06,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:06,001 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:06:06,001 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:06,002 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:06:06,002 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:06:06,003 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:06:06,003 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:06:06,003 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:06:06,370 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:06:06,370 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:06:06,443 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:06:06,819 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:06:06,820 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:06:06,820 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:06:07,024 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:06:22,163 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:06:22,215 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:06:22,215 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:22,216 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:06:22,216 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:22,217 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:06:22,217 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:22,218 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:06:22,220 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,220 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001937s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002415s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002856s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003322s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,224 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,224 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003752s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,225 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:06:22,225 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-10-31 10:06:22,231 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:06:22,231 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:06:22,235 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:06:22,235 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:06:22,237 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:06:22,237 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:22,242 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:06:22,242 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:22,244 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:06:22,244 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00011s] ()
2024-10-31 10:06:22,246 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:06:22,681 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:06:22,681 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:06:22,745 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:06:25,727 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:06:25,734 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:06:25,734 - aiogram.event - feed_update - INFO - Update id=874833177 is not handled. Duration 8 ms by bot id=7942268445
2024-10-31 10:06:25,734 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833177 by bot id=7942268445
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'balance'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2024-10-31 10:08:23,939 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:08:23,940 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:08:23,940 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:08:24,394 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:08:41,879 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:08:41,929 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:08:41,929 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:08:41,931 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:08:41,933 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,933 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001568s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001994s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002437s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002872s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003259s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,937 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:08:41,937 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:08:41,938 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:08:41,938 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:08:41,939 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:08:41,939 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:08:41,940 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:08:41,940 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-10-31 10:08:41,941 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:08:41,941 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:08:41,942 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:08:41,942 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:08:41,943 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:08:42,354 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:08:42,354 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:08:42,421 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:08:42,421 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:08:42,645 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:11:57,019 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:11:57,068 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:11:57,068 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:11:57,069 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:11:57,069 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:11:57,069 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:11:57,070 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:11:57,070 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:11:57,073 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,073 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,074 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,074 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001835s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002287s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002731s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003145s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003548s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,077 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:11:57,077 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-10-31 10:11:57,875 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:11:57,875 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00013s] ()
2024-10-31 10:11:58,195 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:11:58,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00014s] ()
2024-10-31 10:11:58,410 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:11:58,410 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00016s] ()
2024-10-31 10:11:58,731 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:11:58,731 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:11:58,948 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:11:58,948 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00023s] ()
2024-10-31 10:11:59,154 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:11:59,559 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:11:59,559 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:11:59,624 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:12:01,715 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:12:01,723 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:12:01,724 - aiogram.event - feed_update - INFO - Update id=874833178 is not handled. Duration 9 ms by bot id=7942268445
2024-10-31 10:12:01,724 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833178 by bot id=7942268445
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'balance'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2024-10-31 10:13:19,663 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:13:19,663 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:19,663 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:13:19,885 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:13:29,939 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:13:29,989 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:13:29,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:29,991 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:29,993 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,993 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001631s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002063s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002449s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002832s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0032s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,997 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:13:29,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:29,998 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:13:29,998 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:29,999 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:13:29,999 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,000 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:13:30,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,002 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:13:30,366 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:13:30,366 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:13:30,438 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:30,667 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:13:30,667 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:30,667 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:13:30,964 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:13:38,031 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:13:38,084 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:13:38,084 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:38,086 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:38,088 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,088 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001628s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002061s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002416s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002809s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003182s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,092 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:13:38,092 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:13:38,099 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:13:38,099 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:13:38,102 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:13:38,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:13:38,105 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:13:38,105 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:13:38,109 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:13:38,109 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:13:38,111 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:13:38,111 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00015s] ()
2024-10-31 10:13:38,114 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:13:38,559 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:13:38,559 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:13:38,624 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:39,902 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:39,911 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:13:39,911 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] (859676040,)
2024-10-31 10:13:39,912 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:13:39,913 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:39,913 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO users (tg_id, referal_code, referred_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::INTEGER)
2024-10-31 10:13:39,913 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] (859676040, 'HKBE2klc', None)
2024-10-31 10:13:39,914 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO balances (user_id, quantity) VALUES ($1::INTEGER, $2::NUMERIC(10, 2))
2024-10-31 10:13:39,914 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] (859676040, 0.0)
2024-10-31 10:13:39,915 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:13:40,201 - aiogram.event - feed_update - INFO - Update id=874833179 is handled. Duration 299 ms by bot id=7942268445
2024-10-31 10:13:47,336 - aiogram.event - feed_update - INFO - Update id=874833180 is handled. Duration 181 ms by bot id=7942268445
2024-10-31 10:13:50,185 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:50,185 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:13:50,185 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 10.27s ago] (859676040,)
2024-10-31 10:13:50,186 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:13:50,268 - aiogram.event - feed_update - INFO - Update id=874833181 is handled. Duration 83 ms by bot id=7942268445
2024-10-31 10:13:56,630 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:56,631 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:13:56,631 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] (859676040,)
2024-10-31 10:13:56,632 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:13:56,632 - aiogram.event - feed_update - INFO - Update id=874833182 is not handled. Duration 2 ms by bot id=7942268445
2024-10-31 10:13:56,632 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833182 by bot id=7942268445
ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=<core.db_models.models.Ba...bject at 0x78088a44c620>, input_type=Balance]
    For further information visit https://errors.pydantic.dev/2.9/v/string_type
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 172, in get_user_balance
    await message.answer(text=balance)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2038, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=<core.db_models.models.Ba...bject at 0x78088a44c620>, input_type=Balance]
    For further information visit https://errors.pydantic.dev/2.9/v/string_type
2024-10-31 10:15:15,140 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:15:15,140 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:15:15,141 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:15:15,391 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:15:22,272 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:15:22,320 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:15:22,320 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:15:22,321 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:15:22,321 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:15:22,322 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:15:22,322 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:15:22,323 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:15:22,325 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,325 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,326 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,326 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001571s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001973s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002366s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002765s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003157s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:15:22,632 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:15:22,632 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:15:22,688 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:15:26,187 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:15:26,195 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:15:26,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040,)
2024-10-31 10:15:26,196 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:15:26,435 - aiogram.event - feed_update - INFO - Update id=874833183 is handled. Duration 248 ms by bot id=7942268445
2024-10-31 10:15:27,465 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:15:27,466 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:15:27,466 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (859676040,)
2024-10-31 10:15:27,467 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:15:27,539 - aiogram.event - feed_update - INFO - Update id=874833184 is not handled. Duration 74 ms by bot id=7942268445
2024-10-31 10:15:27,539 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833184 by bot id=7942268445
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "core.db_models.models.balance" at byte offset 0
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 172, in get_user_balance
    await message.answer(text=str(balance))
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 488, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "core.db_models.models.balance" at byte offset 0
2024-10-31 10:20:44,308 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:20:44,308 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:20:44,308 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:20:44,525 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:20:50,333 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:20:50,391 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:20:50,391 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:20:50,392 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:20:50,392 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:20:50,393 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:20:50,393 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:20:50,394 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:50,396 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,396 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001752s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002197s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002599s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002995s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003398s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,400 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:20:50,768 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:20:50,769 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:20:50,838 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:20:53,293 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:53,301 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:20:53,301 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] (859676040,)
2024-10-31 10:20:53,302 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:20:53,526 - aiogram.event - feed_update - INFO - Update id=874833185 is handled. Duration 233 ms by bot id=7942268445
2024-10-31 10:20:54,527 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:54,528 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:20:54,528 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (859676040,)
2024-10-31 10:20:54,529 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:20:54,619 - aiogram.event - feed_update - INFO - Update id=874833186 is handled. Duration 93 ms by bot id=7942268445
2024-10-31 10:20:57,305 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:57,305 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:20:57,305 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 4.004s ago] (859676040,)
2024-10-31 10:20:57,306 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:20:57,393 - aiogram.event - feed_update - INFO - Update id=874833187 is handled. Duration 88 ms by bot id=7942268445
2024-10-31 10:21:14,407 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:21:14,407 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:21:14,407 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 19.88s ago] (859676040,)
2024-10-31 10:21:14,408 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:21:14,638 - aiogram.event - feed_update - INFO - Update id=874833188 is handled. Duration 232 ms by bot id=7942268445
2024-10-31 10:21:17,463 - aiogram.event - feed_update - INFO - Update id=874833189 is not handled. Duration 1 ms by bot id=7942268445
2024-10-31 10:21:43,278 - aiogram.event - feed_update - INFO - Update id=874833190 is handled. Duration 183 ms by bot id=7942268445
2024-10-31 10:22:19,069 - aiogram.event - feed_update - INFO - Update id=874833191 is handled. Duration 239 ms by bot id=7942268445
2024-10-31 10:27:43,688 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:27:43,688 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:27:43,688 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:27:43,901 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:27:50,421 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:27:50,470 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:27:50,470 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:27:50,471 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:27:50,471 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:27:50,472 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:27:50,472 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:27:50,473 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:27:50,475 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,475 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,476 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001623s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002036s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002418s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002785s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0032s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,479 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:27:50,841 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:27:50,841 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:27:50,905 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:27:59,505 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:27:59,513 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:27:59,513 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] (859676040,)
2024-10-31 10:27:59,514 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:27:59,757 - aiogram.event - feed_update - INFO - Update id=874833192 is handled. Duration 252 ms by bot id=7942268445
2024-10-31 10:28:00,821 - aiogram.event - feed_update - INFO - Update id=874833193 is handled. Duration 118 ms by bot id=7942268445
2024-10-31 10:28:02,591 - aiogram.event - feed_update - INFO - Update id=874833194 is not handled. Duration 1 ms by bot id=7942268445
2024-10-31 10:29:04,618 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:29:04,618 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:29:04,619 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:29:04,890 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:29:10,947 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:29:11,002 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:29:11,002 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:29:11,003 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:29:11,003 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:29:11,004 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:29:11,004 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:29:11,004 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:29:11,007 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,007 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,008 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,008 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001748s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002167s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002563s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002974s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003356s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:29:11,401 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:29:11,401 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:29:11,482 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:29:14,514 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:29:14,525 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:29:14,525 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00019s] (859676040,)
2024-10-31 10:29:14,526 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:29:14,720 - aiogram.event - feed_update - INFO - Update id=874833195 is handled. Duration 207 ms by bot id=7942268445
2024-10-31 10:29:15,625 - aiogram.event - feed_update - INFO - Update id=874833196 is handled. Duration 158 ms by bot id=7942268445
2024-10-31 10:29:16,552 - aiogram.event - feed_update - INFO - Update id=874833197 is not handled. Duration 1 ms by bot id=7942268445
2024-10-31 10:30:01,767 - aiogram.event - feed_update - INFO - Update id=874833198 is handled. Duration 195 ms by bot id=7942268445
2024-10-31 10:30:03,469 - aiogram.event - feed_update - INFO - Update id=874833199 is handled. Duration 136 ms by bot id=7942268445
2024-10-31 10:30:08,787 - aiogram.event - feed_update - INFO - Update id=874833200 is handled. Duration 77 ms by bot id=7942268445
2024-10-31 10:30:24,325 - aiogram.event - feed_update - INFO - Update id=874833201 is handled. Duration 362 ms by bot id=7942268445
2024-10-31 10:30:30,431 - aiogram.event - feed_update - INFO - Update id=874833202 is handled. Duration 84 ms by bot id=7942268445
2024-10-31 10:30:34,230 - aiogram.event - feed_update - INFO - Update id=874833203 is handled. Duration 123 ms by bot id=7942268445
2024-10-31 10:30:44,775 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:30:44,776 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-10-31 10:30:44,777 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('Цветочек', 'На оранжевом фоне', '10.0', 0, True, 'AgACAgIAAxkBAANdZyMkFAwxNmibp0FQVs3x05d5QGMAAhzlMRtJgxlJf-hWXtzjCw8BAAMCAAN5AAM2BA')
2024-10-31 10:30:44,778 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:30:44,779 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:30:44,780 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-10-31 10:30:44,780 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ('Цветочек',)
2024-10-31 10:30:44,782 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-10-31 10:30:44,782 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (1, 1)
2024-10-31 10:30:44,783 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:30:44,869 - aiogram.event - feed_update - INFO - Update id=874833204 is handled. Duration 94 ms by bot id=7942268445
2024-10-31 10:31:50,938 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:31:50,938 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:31:50,938 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:31:51,127 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
