2024-10-31 09:39:38,325 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:39:41,855 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:39:52,713 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:39:53,039 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:40:32,466 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:40:32,775 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:40:52,008 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:40:52,539 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:42:39,878 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:42:40,467 - __main__ - start - DEBUG - Ошибка приложения Telegram server says - Bad Request: chat not found
2024-10-31 09:43:48,765 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:43:49,080 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:43:49,080 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:43:49,141 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:43:49,221 - aiogram.event - feed_update - INFO - Update id=874833168 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:43:49,221 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833168 by bot id=7942268445
TypeError: object Select can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await select(User).where(User.tg_id == user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Select can't be used in 'await' expression
2024-10-31 09:43:52,125 - aiogram.event - feed_update - INFO - Update id=874833169 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:43:52,125 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833169 by bot id=7942268445
TypeError: object Select can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await select(User).where(User.tg_id == user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Select can't be used in 'await' expression
2024-10-31 09:43:54,480 - aiogram.event - feed_update - INFO - Update id=874833170 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:43:54,480 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833170 by bot id=7942268445
TypeError: object Select can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await select(User).where(User.tg_id == user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object Select can't be used in 'await' expression
2024-10-31 09:45:18,236 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:45:18,236 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:45:18,236 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:45:18,457 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:45:27,286 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:45:27,761 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:45:27,761 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:45:27,828 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:45:30,982 - aiogram.event - feed_update - INFO - Update id=874833171 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:45:30,982 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833171 by bot id=7942268445
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    user = await session.execute(result).scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
2024-10-31 09:45:33,497 - aiogram.event - feed_update - INFO - Update id=874833172 is not handled. Duration 0 ms by bot id=7942268445
2024-10-31 09:45:33,497 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833172 by bot id=7942268445
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    user = await session.execute(result).scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'scalar_one_or_none'
2024-10-31 09:48:21,370 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:48:21,370 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:48:21,370 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:48:21,644 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:48:28,653 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:48:29,031 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:48:29,031 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:48:29,099 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:48:30,494 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:48:30,494 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:48:30,496 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:48:30,496 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:48:30,497 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:48:30,497 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:48:30,497 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:48:30,500 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:48:30,500 - aiogram.event - feed_update - INFO - Update id=874833173 is not handled. Duration 54 ms by bot id=7942268445
2024-10-31 09:48:30,500 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833173 by bot id=7942268445
NoReferencedColumnError: Could not initialize target column for ForeignKey 'users.id' on table 'shopping_cart': table 'users' has no column named 'id'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    users = await session.execute(result)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1644, in do_init
    self._setup_join_conditions()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1884, in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
                                ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2310, in __init__
    self._determine_joins()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2423, in _determine_joins
    self.primaryjoin = join_condition(
                       ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/util.py", line 123, in join_condition
    return Join._join_condition(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py", line 1363, in _join_condition
    constraints = cls._joincond_scan_left_right(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py", line 1451, in _joincond_scan_left_right
    col = fk.get_referent(left)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3033, in get_referent
    return table.columns.corresponding_column(self.column)  # type: ignore
                                              ^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1141, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3170, in column
    return self._resolve_column()
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3209, in _resolve_column
    return self._link_to_col_by_colstring(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py", line 3131, in _link_to_col_by_colstring
    raise exc.NoReferencedColumnError(
sqlalchemy.exc.NoReferencedColumnError: Could not initialize target column for ForeignKey 'users.id' on table 'shopping_cart': table 'users' has no column named 'id'
2024-10-31 09:50:50,472 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:50:50,473 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:50:50,473 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:50:50,706 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:50:59,426 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:50:59,475 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:50:59,475 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:50:59,476 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:50:59,476 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:50:59,477 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:50:59,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:50:59,478 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:50:59,480 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,480 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,489 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,490 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.009678s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,490 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,490 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01038s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,491 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,491 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01118s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,492 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,492 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01185s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,492 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:50:59,493 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01259s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:50:59,493 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:50:59,494 - __main__ - start - DEBUG - Ошибка приложения Foreign key associated with column 'users.referred_by' could not find table 'user' with which to generate a foreign key to target column 'id'
2024-10-31 09:52:10,645 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:52:10,696 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:52:10,696 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:52:10,697 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:52:10,697 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:52:10,698 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:52:10,698 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:52:10,698 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:52:10,701 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,701 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,702 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,702 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0017s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002111s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,703 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002505s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002891s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003264s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:52:10,704 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:52:10,705 - __main__ - start - DEBUG - Ошибка приложения Foreign key associated with column 'users.referred_by' could not find table 'user' with which to generate a foreign key to target column 'id'
2024-10-31 09:53:48,834 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:53:48,883 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:53:48,883 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:53:48,884 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:53:48,885 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:53:48,887 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,887 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,889 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,889 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001866s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002323s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002699s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00307s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,891 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:53:48,891 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003458s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:53:48,891 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:53:48,891 - __main__ - start - DEBUG - Ошибка приложения Could not initialize target column for ForeignKey 'users.id' on table 'users': table 'users' has no column named 'id'
2024-10-31 09:54:10,126 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:54:10,175 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:54:10,175 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:54:10,176 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:54:10,176 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:54:10,177 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:54:10,177 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:54:10,177 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:54:10,180 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,180 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,181 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001902s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002319s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,182 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002721s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003119s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:54:10,183 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003507s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:54:10,184 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 09:54:10,184 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:54:10,202 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 09:54:10,202 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00011s] ()
2024-10-31 09:54:10,206 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 09:54:10,206 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 09:54:10,210 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 09:54:10,210 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 09:54:10,214 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 09:54:10,214 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:54:10,216 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 09:54:10,216 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 09:54:10,220 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 09:54:10,532 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:54:10,532 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:54:10,591 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:54:14,127 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:54:14,133 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 09:54:14,133 - aiogram.event - feed_update - INFO - Update id=874833174 is not handled. Duration 6 ms by bot id=7942268445
2024-10-31 09:54:14,133 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833174 by bot id=7942268445
InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'Order_item'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 49, in get_user
    users = await session.execute(result)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1854, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
2024-10-31 09:58:06,038 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:58:06,039 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:58:06,039 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:58:06,229 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 09:59:46,145 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 09:59:46,194 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 09:59:46,194 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 09:59:46,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 09:59:46,196 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 09:59:46,198 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,198 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,199 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001585s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001996s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,200 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002386s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002773s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 09:59:46,201 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003149s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 09:59:46,202 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 09:59:46,202 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,203 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 09:59:46,203 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 09:59:46,204 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 09:59:46,204 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,205 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 09:59:46,205 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,206 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 09:59:46,206 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 09:59:46,207 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 09:59:46,593 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 09:59:46,593 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 09:59:46,660 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:59:48,145 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 09:59:48,146 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 09:59:48,146 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 09:59:48,407 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:00:11,558 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:00:11,608 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:00:11,608 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:00:11,609 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:00:11,609 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:00:11,610 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:00:11,610 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:00:11,610 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:00:11,613 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,613 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,614 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,614 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001676s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002152s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,615 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002667s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003019s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:00:11,616 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003369s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:00:11,617 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:00:11,617 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,623 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:00:11,623 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00013s] ()
2024-10-31 10:00:11,627 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:00:11,627 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,630 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:00:11,630 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,633 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:00:11,634 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:00:11,635 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:00:11,636 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:00:11,638 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:00:12,164 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:00:12,164 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:00:12,233 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:00:14,725 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:00:14,730 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:00:14,730 - aiogram.event - feed_update - INFO - Update id=874833175 is not handled. Duration 5 ms by bot id=7942268445
2024-10-31 10:00:14,730 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833175 by bot id=7942268445
InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'Order_item'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1854, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
2024-10-31 10:03:02,530 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:03:02,531 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:02,531 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:03:02,779 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:03:15,589 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:03:15,639 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:03:15,639 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:15,640 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:03:15,640 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:15,641 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:03:15,641 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:15,641 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:03:15,644 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,644 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,645 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,645 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001574s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001998s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,646 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002402s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003141s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:15,647 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003528s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:15,648 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:03:15,648 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:03:15,649 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:03:15,649 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:03:15,650 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:03:15,650 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:03:15,651 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:03:15,652 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:03:15,652 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:03:15,653 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:03:16,059 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:03:16,059 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:03:16,125 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:16,287 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:03:16,287 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:16,288 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:03:16,503 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:03:24,318 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:03:24,368 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:03:24,369 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:03:24,370 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:03:24,371 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:03:24,373 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,373 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001761s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,375 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002254s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002684s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,376 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003081s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003463s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:03:24,377 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:03:24,385 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:03:24,385 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00013s] ()
2024-10-31 10:03:24,389 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:03:24,389 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00011s] ()
2024-10-31 10:03:24,392 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:03:24,392 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:03:24,397 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:03:24,397 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:03:24,399 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:03:24,399 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:03:24,402 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:03:24,726 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:03:24,726 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:03:24,812 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:03:25,610 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:03:25,615 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:03:25,615 - aiogram.event - feed_update - INFO - Update id=874833176 is not handled. Duration 5 ms by bot id=7942268445
2024-10-31 10:03:25,615 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833176 by bot id=7942268445
InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 516, in _resolve_name
    rval = d[token]
           ~^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_collections.py", line 345, in __missing__
    self[key] = val = self.creator(key)
                      ^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 484, in _access_cls
    return self.fallback[key]
           ~~~~~~~~~~~~~^^^^^
KeyError: 'Order_item'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1854, in _setup_entity
    self._clsregistry_resolve_name(argument)(),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 520, in _resolve_name
    self._raise_for_name(name, err)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/clsregistry.py", line 501, in _raise_for_name
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: When initializing mapper Mapper[Order(orders)], expression 'Order_item' failed to locate a name ('Order_item'). If this is a class name, consider adding this relationship() to the <class 'core.db_models.models.Order'> class after both dependent classes have been defined.
2024-10-31 10:05:50,170 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:05:50,171 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:05:50,171 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:05:50,389 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:06:05,938 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:06:05,989 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:06:05,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:06:05,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:05,991 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:06:05,993 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,993 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002785s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003254s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00366s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.004048s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:05,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.004489s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:05,998 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:06:05,998 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:06:05,999 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:06:06,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:06:06,000 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:06:06,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:06,001 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:06:06,001 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:06,002 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:06:06,002 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:06:06,003 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:06:06,003 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:06:06,003 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:06:06,370 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:06:06,370 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:06:06,443 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:06:06,819 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:06:06,820 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:06:06,820 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:06:07,024 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:06:22,163 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:06:22,215 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:06:22,215 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:22,216 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:06:22,216 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:22,217 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:06:22,217 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:06:22,218 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:06:22,220 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,220 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001937s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,222 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002415s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002856s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,223 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003322s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,224 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:06:22,224 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003752s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:06:22,225 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:06:22,225 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-10-31 10:06:22,231 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:06:22,231 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:06:22,235 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:06:22,235 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:06:22,237 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:06:22,237 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:22,242 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:06:22,242 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:06:22,244 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:06:22,244 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00011s] ()
2024-10-31 10:06:22,246 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:06:22,681 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:06:22,681 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:06:22,745 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:06:25,727 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:06:25,734 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:06:25,734 - aiogram.event - feed_update - INFO - Update id=874833177 is not handled. Duration 8 ms by bot id=7942268445
2024-10-31 10:06:25,734 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833177 by bot id=7942268445
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'balance'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2024-10-31 10:08:23,939 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:08:23,940 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:08:23,940 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:08:24,394 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:08:41,879 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:08:41,929 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:08:41,929 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:08:41,930 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:08:41,931 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:08:41,933 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,933 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001568s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,935 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001994s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002437s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002872s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:08:41,936 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003259s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:08:41,937 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:08:41,937 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:08:41,938 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:08:41,938 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-10-31 10:08:41,939 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:08:41,939 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:08:41,940 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:08:41,940 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-10-31 10:08:41,941 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:08:41,941 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:08:41,942 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:08:41,942 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:08:41,943 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:08:42,354 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:08:42,354 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:08:42,421 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:08:42,421 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:08:42,645 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:11:57,019 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:11:57,068 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:11:57,068 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:11:57,069 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:11:57,069 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:11:57,069 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:11:57,070 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:11:57,070 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:11:57,073 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,073 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,074 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,074 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001835s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002287s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,075 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002731s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003145s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:11:57,076 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003548s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:11:57,077 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:11:57,077 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-10-31 10:11:57,875 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:11:57,875 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00013s] ()
2024-10-31 10:11:58,195 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:11:58,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00014s] ()
2024-10-31 10:11:58,410 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:11:58,410 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00016s] ()
2024-10-31 10:11:58,731 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:11:58,731 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-10-31 10:11:58,948 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:11:58,948 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00023s] ()
2024-10-31 10:11:59,154 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:11:59,559 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:11:59,559 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:11:59,624 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:12:01,715 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:12:01,723 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:12:01,724 - aiogram.event - feed_update - INFO - Update id=874833178 is not handled. Duration 9 ms by bot id=7942268445
2024-10-31 10:12:01,724 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833178 by bot id=7942268445
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'balance'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 44, in get_start
    result = await get_user(user_id=user_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 48, in get_user
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'balance'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2024-10-31 10:13:19,663 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:13:19,663 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:19,663 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:13:19,885 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:13:29,939 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:13:29,989 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:13:29,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:13:29,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:29,991 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:29,993 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,993 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001631s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,995 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002063s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002449s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002832s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,996 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:29,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0032s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:29,997 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-10-31 10:13:29,997 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:29,998 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-10-31 10:13:29,998 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:29,999 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-10-31 10:13:29,999 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,000 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-10-31 10:13:30,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-10-31 10:13:30,001 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-10-31 10:13:30,002 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:13:30,366 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:13:30,366 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:13:30,438 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:30,667 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:13:30,667 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:30,667 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:13:30,964 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:13:38,031 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:13:38,084 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:13:38,084 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:13:38,085 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:13:38,086 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:38,088 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,088 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001628s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002061s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,090 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002416s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002809s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:13:38,091 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003182s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:13:38,092 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-10-31 10:13:38,092 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:13:38,099 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-10-31 10:13:38,099 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:13:38,102 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:13:38,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:13:38,105 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:13:38,105 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-10-31 10:13:38,109 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-10-31 10:13:38,109 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00008s] ()
2024-10-31 10:13:38,111 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-10-31 10:13:38,111 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00015s] ()
2024-10-31 10:13:38,114 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:13:38,559 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:13:38,559 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:13:38,624 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:13:39,902 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:39,911 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:13:39,911 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] (859676040,)
2024-10-31 10:13:39,912 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:13:39,913 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:39,913 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO users (tg_id, referal_code, referred_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::INTEGER)
2024-10-31 10:13:39,913 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] (859676040, 'HKBE2klc', None)
2024-10-31 10:13:39,914 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO balances (user_id, quantity) VALUES ($1::INTEGER, $2::NUMERIC(10, 2))
2024-10-31 10:13:39,914 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] (859676040, 0.0)
2024-10-31 10:13:39,915 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:13:40,201 - aiogram.event - feed_update - INFO - Update id=874833179 is handled. Duration 299 ms by bot id=7942268445
2024-10-31 10:13:47,336 - aiogram.event - feed_update - INFO - Update id=874833180 is handled. Duration 181 ms by bot id=7942268445
2024-10-31 10:13:50,185 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:50,185 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:13:50,185 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 10.27s ago] (859676040,)
2024-10-31 10:13:50,186 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:13:50,268 - aiogram.event - feed_update - INFO - Update id=874833181 is handled. Duration 83 ms by bot id=7942268445
2024-10-31 10:13:56,630 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:13:56,631 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:13:56,631 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] (859676040,)
2024-10-31 10:13:56,632 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:13:56,632 - aiogram.event - feed_update - INFO - Update id=874833182 is not handled. Duration 2 ms by bot id=7942268445
2024-10-31 10:13:56,632 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833182 by bot id=7942268445
ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=<core.db_models.models.Ba...bject at 0x78088a44c620>, input_type=Balance]
    For further information visit https://errors.pydantic.dev/2.9/v/string_type
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 172, in get_user_balance
    await message.answer(text=balance)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2038, in answer
    return SendMessage(
           ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for SendMessage
text
  Input should be a valid string [type=string_type, input_value=<core.db_models.models.Ba...bject at 0x78088a44c620>, input_type=Balance]
    For further information visit https://errors.pydantic.dev/2.9/v/string_type
2024-10-31 10:15:15,140 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:15:15,140 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:15:15,141 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:15:15,391 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:15:22,272 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:15:22,320 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:15:22,320 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:15:22,321 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:15:22,321 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:15:22,322 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:15:22,322 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:15:22,323 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:15:22,325 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,325 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,326 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,326 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001571s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001973s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,327 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002366s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002765s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003157s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:15:22,328 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:15:22,632 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:15:22,632 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:15:22,688 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:15:26,187 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:15:26,195 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:15:26,195 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040,)
2024-10-31 10:15:26,196 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:15:26,435 - aiogram.event - feed_update - INFO - Update id=874833183 is handled. Duration 248 ms by bot id=7942268445
2024-10-31 10:15:27,465 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:15:27,466 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:15:27,466 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (859676040,)
2024-10-31 10:15:27,467 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:15:27,539 - aiogram.event - feed_update - INFO - Update id=874833184 is not handled. Duration 74 ms by bot id=7942268445
2024-10-31 10:15:27,539 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833184 by bot id=7942268445
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "core.db_models.models.balance" at byte offset 0
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 172, in get_user_balance
    await message.answer(text=str(balance))
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 488, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "core.db_models.models.balance" at byte offset 0
2024-10-31 10:20:44,308 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:20:44,308 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:20:44,308 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:20:44,525 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:20:50,333 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:20:50,391 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:20:50,391 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:20:50,392 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:20:50,392 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:20:50,393 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:20:50,393 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:20:50,394 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:50,396 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,396 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001752s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002197s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,398 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002599s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002995s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:20:50,399 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003398s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:20:50,400 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:20:50,768 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:20:50,769 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:20:50,838 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:20:53,293 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:53,301 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:20:53,301 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] (859676040,)
2024-10-31 10:20:53,302 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:20:53,526 - aiogram.event - feed_update - INFO - Update id=874833185 is handled. Duration 233 ms by bot id=7942268445
2024-10-31 10:20:54,527 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:54,528 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:20:54,528 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (859676040,)
2024-10-31 10:20:54,529 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:20:54,619 - aiogram.event - feed_update - INFO - Update id=874833186 is handled. Duration 93 ms by bot id=7942268445
2024-10-31 10:20:57,305 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:20:57,305 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:20:57,305 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 4.004s ago] (859676040,)
2024-10-31 10:20:57,306 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:20:57,393 - aiogram.event - feed_update - INFO - Update id=874833187 is handled. Duration 88 ms by bot id=7942268445
2024-10-31 10:21:14,407 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:21:14,407 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-10-31 10:21:14,407 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 19.88s ago] (859676040,)
2024-10-31 10:21:14,408 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:21:14,638 - aiogram.event - feed_update - INFO - Update id=874833188 is handled. Duration 232 ms by bot id=7942268445
2024-10-31 10:21:17,463 - aiogram.event - feed_update - INFO - Update id=874833189 is not handled. Duration 1 ms by bot id=7942268445
2024-10-31 10:21:43,278 - aiogram.event - feed_update - INFO - Update id=874833190 is handled. Duration 183 ms by bot id=7942268445
2024-10-31 10:22:19,069 - aiogram.event - feed_update - INFO - Update id=874833191 is handled. Duration 239 ms by bot id=7942268445
2024-10-31 10:27:43,688 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:27:43,688 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:27:43,688 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:27:43,901 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:27:50,421 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:27:50,470 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:27:50,470 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:27:50,471 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:27:50,471 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:27:50,472 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:27:50,472 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:27:50,473 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:27:50,475 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,475 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,476 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001623s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002036s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002418s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002785s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:27:50,478 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0032s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:27:50,479 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:27:50,841 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:27:50,841 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:27:50,905 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:27:59,505 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:27:59,513 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:27:59,513 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] (859676040,)
2024-10-31 10:27:59,514 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:27:59,757 - aiogram.event - feed_update - INFO - Update id=874833192 is handled. Duration 252 ms by bot id=7942268445
2024-10-31 10:28:00,821 - aiogram.event - feed_update - INFO - Update id=874833193 is handled. Duration 118 ms by bot id=7942268445
2024-10-31 10:28:02,591 - aiogram.event - feed_update - INFO - Update id=874833194 is not handled. Duration 1 ms by bot id=7942268445
2024-10-31 10:29:04,618 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:29:04,618 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:29:04,619 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:29:04,890 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-10-31 10:29:10,947 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-10-31 10:29:11,002 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-10-31 10:29:11,002 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:29:11,003 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-10-31 10:29:11,003 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:29:11,004 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-10-31 10:29:11,004 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-10-31 10:29:11,004 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:29:11,007 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,007 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,008 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,008 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001748s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002167s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002563s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,009 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002974s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003356s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-10-31 10:29:11,010 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:29:11,401 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-10-31 10:29:11,401 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-10-31 10:29:11,482 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:29:14,514 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:29:14,525 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-10-31 10:29:14,525 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00019s] (859676040,)
2024-10-31 10:29:14,526 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-10-31 10:29:14,720 - aiogram.event - feed_update - INFO - Update id=874833195 is handled. Duration 207 ms by bot id=7942268445
2024-10-31 10:29:15,625 - aiogram.event - feed_update - INFO - Update id=874833196 is handled. Duration 158 ms by bot id=7942268445
2024-10-31 10:29:16,552 - aiogram.event - feed_update - INFO - Update id=874833197 is not handled. Duration 1 ms by bot id=7942268445
2024-10-31 10:30:01,767 - aiogram.event - feed_update - INFO - Update id=874833198 is handled. Duration 195 ms by bot id=7942268445
2024-10-31 10:30:03,469 - aiogram.event - feed_update - INFO - Update id=874833199 is handled. Duration 136 ms by bot id=7942268445
2024-10-31 10:30:08,787 - aiogram.event - feed_update - INFO - Update id=874833200 is handled. Duration 77 ms by bot id=7942268445
2024-10-31 10:30:24,325 - aiogram.event - feed_update - INFO - Update id=874833201 is handled. Duration 362 ms by bot id=7942268445
2024-10-31 10:30:30,431 - aiogram.event - feed_update - INFO - Update id=874833202 is handled. Duration 84 ms by bot id=7942268445
2024-10-31 10:30:34,230 - aiogram.event - feed_update - INFO - Update id=874833203 is handled. Duration 123 ms by bot id=7942268445
2024-10-31 10:30:44,775 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:30:44,776 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-10-31 10:30:44,777 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('Цветочек', 'На оранжевом фоне', '10.0', 0, True, 'AgACAgIAAxkBAANdZyMkFAwxNmibp0FQVs3x05d5QGMAAhzlMRtJgxlJf-hWXtzjCw8BAAMCAAN5AAM2BA')
2024-10-31 10:30:44,778 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:30:44,779 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-10-31 10:30:44,780 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-10-31 10:30:44,780 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ('Цветочек',)
2024-10-31 10:30:44,782 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-10-31 10:30:44,782 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (1, 1)
2024-10-31 10:30:44,783 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-10-31 10:30:44,869 - aiogram.event - feed_update - INFO - Update id=874833204 is handled. Duration 94 ms by bot id=7942268445
2024-10-31 10:31:50,938 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-10-31 10:31:50,938 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-10-31 10:31:50,938 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-10-31 10:31:51,127 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 21:58:51,548 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 21:58:51,627 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 21:58:51,627 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 21:58:51,629 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 21:58:51,629 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 21:58:51,630 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 21:58:51,630 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 21:58:51,631 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 21:58:51,633 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 21:58:51,634 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 21:58:51,641 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 21:58:51,641 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00789s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 21:58:51,642 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 21:58:51,642 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.008366s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 21:58:51,642 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 21:58:51,642 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.008797s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 21:58:51,643 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 21:58:51,643 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.009214s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 21:58:51,643 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 21:58:51,643 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.009615s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 21:58:51,643 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 21:58:52,305 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 21:58:52,305 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 21:58:52,410 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 21:59:35,414 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 21:59:35,422 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 21:59:35,422 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] (859676040,)
2024-11-02 21:59:35,424 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 21:59:35,703 - aiogram.event - feed_update - INFO - Update id=874833205 is handled. Duration 289 ms by bot id=7942268445
2024-11-02 21:59:37,223 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 21:59:37,223 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 21:59:37,224 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ()
2024-11-02 21:59:37,224 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 21:59:37,225 - aiogram.event - feed_update - INFO - Update id=874833206 is not handled. Duration 3 ms by bot id=7942268445
2024-11-02 21:59:37,225 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833206 by bot id=7942268445
AttributeError: 'ChunkedIteratorResult' object has no attribute 'sclars'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 267, in catalog
    products = await get_all_products()
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 245, in get_all_products
    product = result.sclars().all()
              ^^^^^^^^^^^^^
AttributeError: 'ChunkedIteratorResult' object has no attribute 'sclars'. Did you mean: 'scalars'?
2024-11-02 22:00:09,000 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:00:09,000 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:00:09,000 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:00:09,343 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:00:16,297 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:00:16,346 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:00:16,346 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:00:16,347 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:00:16,347 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:00:16,347 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:00:16,347 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:00:16,348 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:00:16,351 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:00:16,351 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:00:16,353 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:00:16,353 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001815s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:00:16,353 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:00:16,353 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002296s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:00:16,354 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:00:16,354 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002757s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:00:16,354 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:00:16,354 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003224s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:00:16,355 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:00:16,355 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003669s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:00:16,355 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:00:16,843 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:00:16,844 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:00:16,907 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:00:19,155 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:00:19,164 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:00:19,164 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] ()
2024-11-02 22:00:19,165 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:00:20,594 - aiogram.event - feed_update - INFO - Update id=874833207 is handled. Duration 1441 ms by bot id=7942268445
2024-11-02 22:00:49,604 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:00:49,604 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:00:49,604 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:00:49,821 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:11:37,230 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:11:37,279 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:11:37,279 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:11:37,280 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:11:37,280 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:11:37,281 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:11:37,281 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:11:37,282 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:11:37,284 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:11:37,284 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:11:37,286 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:11:37,286 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001783s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:11:37,286 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:11:37,286 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00222s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:11:37,286 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:11:37,286 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002627s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:11:37,287 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:11:37,287 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003039s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:11:37,287 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:11:37,287 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003431s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:11:37,288 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:11:37,716 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:11:37,716 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:11:37,798 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:11:40,351 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:11:40,360 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:11:40,360 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ()
2024-11-02 22:11:40,361 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:11:40,361 - aiogram.event - feed_update - INFO - Update id=874833208 is not handled. Duration 11 ms by bot id=7942268445
2024-11-02 22:11:40,361 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833208 by bot id=7942268445
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 283, in catalog
    reply_markup=InlineKeyBoards.create_keyboard_inline(buttons
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/keyboards/reply_inline.py", line 53, in create_keyboard_inline
    links_kb = InlineKeyboardMarkup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
2024-11-02 22:12:40,345 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:12:40,345 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:12:40,345 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 59.99s ago] ()
2024-11-02 22:12:40,346 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:12:40,346 - aiogram.event - feed_update - INFO - Update id=874833209 is not handled. Duration 2 ms by bot id=7942268445
2024-11-02 22:12:40,346 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833209 by bot id=7942268445
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 283, in catalog
    reply_markup=InlineKeyBoards.create_keyboard_inline(buttons
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/keyboards/reply_inline.py", line 53, in create_keyboard_inline
    links_kb = InlineKeyboardMarkup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
2024-11-02 22:12:41,715 - aiogram.event - feed_update - INFO - Update id=874833210 is handled. Duration 237 ms by bot id=7942268445
2024-11-02 22:12:43,999 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:12:44,000 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:12:44,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040,)
2024-11-02 22:12:44,001 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:12:44,097 - aiogram.event - feed_update - INFO - Update id=874833211 is handled. Duration 98 ms by bot id=7942268445
2024-11-02 22:12:45,804 - aiogram.event - feed_update - INFO - Update id=874833212 is not handled. Duration 1 ms by bot id=7942268445
2024-11-02 22:12:53,032 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:12:53,032 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT balances.user_id, balances.quantity 
FROM balances 
WHERE balances.user_id = $1::INTEGER
2024-11-02 22:12:53,032 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040,)
2024-11-02 22:12:53,034 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:12:53,212 - aiogram.event - feed_update - INFO - Update id=874833213 is handled. Duration 181 ms by bot id=7942268445
2024-11-02 22:12:54,451 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:12:54,451 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:12:54,451 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 10.45s ago] (859676040,)
2024-11-02 22:12:54,452 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:12:54,559 - aiogram.event - feed_update - INFO - Update id=874833214 is handled. Duration 108 ms by bot id=7942268445
2024-11-02 22:17:01,772 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:17:01,773 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:17:01,773 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:17:02,005 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:17:08,990 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:17:09,039 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:17:09,039 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:17:09,040 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:17:09,040 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:17:09,041 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:17:09,041 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:17:09,041 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:17:09,044 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:17:09,044 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:17:09,045 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:17:09,045 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001664s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:17:09,046 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:17:09,046 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00211s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:17:09,046 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:17:09,046 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002494s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:17:09,046 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:17:09,046 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002868s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:17:09,047 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:17:09,047 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003246s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:17:09,047 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:17:09,891 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:17:09,891 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:17:09,969 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:17:12,386 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:17:12,394 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:17:12,394 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] (859676040,)
2024-11-02 22:17:12,396 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:17:12,719 - aiogram.event - feed_update - INFO - Update id=874833215 is handled. Duration 333 ms by bot id=7942268445
2024-11-02 22:17:18,534 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:17:18,534 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:17:18,534 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 6.14s ago] (859676040,)
2024-11-02 22:17:18,535 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:17:18,682 - aiogram.event - feed_update - INFO - Update id=874833216 is handled. Duration 148 ms by bot id=7942268445
2024-11-02 22:17:19,544 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:17:19,545 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:17:19,545 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ()
2024-11-02 22:17:19,546 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:17:19,546 - aiogram.event - feed_update - INFO - Update id=874833217 is not handled. Duration 4 ms by bot id=7942268445
2024-11-02 22:17:19,546 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833217 by bot id=7942268445
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 285, in catalog
    reply_markup=InlineKeyBoards.create_keyboard_inline(buttons
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/keyboards/reply_inline.py", line 52, in create_keyboard_inline
    links_kb = InlineKeyboardMarkup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
2024-11-02 22:18:09,385 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:18:09,385 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:18:09,385 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:18:09,660 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:18:16,053 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:18:16,102 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:18:16,102 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:18:16,103 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:18:16,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:18:16,104 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:18:16,104 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:18:16,104 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:18:16,106 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:18:16,107 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:18:16,108 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:18:16,108 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001679s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:18:16,108 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:18:16,109 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002075s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:18:16,109 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:18:16,109 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002443s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:18:16,109 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:18:16,109 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002792s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:18:16,110 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:18:16,110 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003128s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:18:16,110 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:18:16,607 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:18:16,607 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:18:16,691 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:18:17,263 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:18:17,271 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:18:17,271 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ()
2024-11-02 22:18:17,272 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:18:17,273 - aiogram.event - feed_update - INFO - Update id=874833218 is not handled. Duration 11 ms by bot id=7942268445
2024-11-02 22:18:17,273 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833218 by bot id=7942268445
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 285, in catalog
    reply_markup=InlineKeyBoards.create_keyboard_inline(buttons
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/keyboards/reply_inline.py", line 52, in create_keyboard_inline
    links_kb = InlineKeyboardMarkup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
2024-11-02 22:19:44,426 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:19:44,427 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:19:44,427 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:19:44,735 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:20:58,308 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:20:58,356 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:20:58,356 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:20:58,357 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:20:58,357 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:20:58,358 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:20:58,358 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:20:58,359 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:20:58,361 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:20:58,361 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00018s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:20:58,363 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:20:58,363 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001777s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:20:58,363 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:20:58,363 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002278s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:20:58,364 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:20:58,364 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002702s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:20:58,364 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:20:58,364 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003139s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:20:58,365 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:20:58,365 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003538s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:20:58,365 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:20:58,672 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:20:58,672 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:20:58,743 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:20:59,010 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:20:59,018 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:20:59,018 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] ()
2024-11-02 22:20:59,019 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:20:59,019 - aiogram.event - feed_update - INFO - Update id=874833219 is not handled. Duration 11 ms by bot id=7942268445
2024-11-02 22:20:59,019 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833219 by bot id=7942268445
AttributeError: 'InlineKeyboardMarkup' object has no attribute 'add'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 285, in catalog
    reply_markup=InlineKeyBoards.create_keyboard_inline(buttons
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/keyboards/reply_inline.py", line 60, in create_keyboard_inline
    links_kb.add(InlineKeyboardButton(text=text,
    ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 856, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'InlineKeyboardMarkup' object has no attribute 'add'
2024-11-02 22:22:47,223 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:22:47,224 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:22:47,224 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:22:47,557 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:22:58,200 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:22:58,249 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:22:58,249 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:22:58,250 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:22:58,250 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:22:58,250 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:22:58,250 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:22:58,251 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:22:58,253 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:22:58,254 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:22:58,255 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:22:58,255 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001643s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:22:58,255 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:22:58,256 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00216s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:22:58,256 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:22:58,256 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002627s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:22:58,256 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:22:58,256 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003064s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:22:58,257 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:22:58,257 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003491s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:22:58,257 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:22:58,713 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:22:58,714 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:22:58,789 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:22:58,905 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:22:58,913 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:22:58,913 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] ()
2024-11-02 22:22:58,914 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:22:58,915 - aiogram.event - feed_update - INFO - Update id=874833220 is not handled. Duration 11 ms by bot id=7942268445
2024-11-02 22:22:58,915 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833220 by bot id=7942268445
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 285, in catalog
    reply_markup=InlineKeyBoards.create_keyboard_inline(buttons
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/keyboards/reply_inline.py", line 56, in create_keyboard_inline
    links_kb = InlineKeyboardMarkup()
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.9/v/missing
2024-11-02 22:30:24,429 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:30:24,429 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:30:24,429 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:30:24,679 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:30:40,167 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:30:40,218 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:30:40,218 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:30:40,219 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:30:40,219 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:30:40,219 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:30:40,219 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:30:40,220 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:30:40,223 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:30:40,223 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:30:40,225 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:30:40,225 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002401s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:30:40,226 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:30:40,226 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002902s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:30:40,226 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:30:40,226 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003363s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:30:40,227 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:30:40,227 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003804s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:30:40,227 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:30:40,227 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.004229s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:30:40,227 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:30:40,525 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:30:40,525 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:30:40,583 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:30:41,102 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:30:41,110 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:30:41,110 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] ()
2024-11-02 22:30:41,111 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:30:41,112 - aiogram.event - feed_update - INFO - Update id=874833221 is not handled. Duration 11 ms by bot id=7942268445
2024-11-02 22:30:41,112 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833221 by bot id=7942268445
ValidationError: 4 validation errors for SendPhoto
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 282, in catalog
    await message.answer_photo(
          ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 2187, in answer_photo
    return SendPhoto(
           ^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendPhoto
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x7f1e48006ed0>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2024-11-02 22:31:28,262 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:31:28,262 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:31:28,262 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:31:28,539 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:31:34,242 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:31:34,290 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:31:34,316 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:31:34,317 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:31:34,317 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:31:34,318 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:31:34,318 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:31:34,318 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:31:34,321 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:31:34,321 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:31:34,322 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:31:34,323 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001723s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:31:34,323 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:31:34,323 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002131s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:31:34,323 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:31:34,323 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.0025s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:31:34,324 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:31:34,324 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00285s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:31:34,324 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:31:34,324 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003202s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:31:34,324 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:31:34,632 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:31:34,632 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:31:34,698 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:31:34,987 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:31:34,995 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:31:34,995 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ()
2024-11-02 22:31:34,996 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:31:35,333 - aiogram.event - feed_update - INFO - Update id=874833222 is handled. Duration 347 ms by bot id=7942268445
2024-11-02 22:31:39,853 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:31:39,859 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:31:39,859 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 4.864s ago] ()
2024-11-02 22:31:39,860 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:31:40,037 - aiogram.event - feed_update - INFO - Update id=874833223 is handled. Duration 185 ms by bot id=7942268445
2024-11-02 22:50:14,165 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:50:14,165 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:50:14,166 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:50:14,387 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:50:21,419 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:50:21,469 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:50:21,469 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:50:21,470 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:50:21,470 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:50:21,470 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:50:21,470 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:50:21,471 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:50:21,473 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:50:21,474 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:50:21,475 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:50:21,475 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002117s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:50:21,476 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:50:21,476 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002621s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:50:21,476 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:50:21,476 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003076s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:50:21,477 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:50:21,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003529s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:50:21,477 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:50:21,477 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003991s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:50:21,478 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:50:21,800 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:50:21,800 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:50:21,868 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:50:28,171 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:50:28,179 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:50:28,180 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00019s] (859676040,)
2024-11-02 22:50:28,181 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:50:28,419 - aiogram.event - feed_update - INFO - Update id=874833224 is handled. Duration 248 ms by bot id=7942268445
2024-11-02 22:50:29,179 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:50:29,180 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:50:29,180 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] ()
2024-11-02 22:50:29,181 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:50:29,281 - aiogram.event - feed_update - INFO - Update id=874833225 is handled. Duration 103 ms by bot id=7942268445
2024-11-02 22:50:30,580 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:50:30,581 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::VARCHAR
2024-11-02 22:50:30,581 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] ('1',)
2024-11-02 22:50:30,583 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:50:30,583 - aiogram.event - feed_update - INFO - Update id=874833226 is not handled. Duration 3 ms by bot id=7942268445
2024-11-02 22:50:30,583 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833226 by bot id=7942268445
ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: integer = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::VARCHAR]
[parameters: ('1',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedFunctionError: operator does not exist: integer = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: integer = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 305, in delete_one_item
    result = await delete_item(item_id=item_id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 268, in delete_item
    results = await session.execute(
              ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: integer = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::VARCHAR]
[parameters: ('1',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2024-11-02 22:51:17,865 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:51:17,866 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:51:17,866 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:51:18,086 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:51:24,209 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:51:24,261 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:51:24,261 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:51:24,262 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:51:24,262 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:51:24,262 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:51:24,262 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:51:24,263 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:51:24,265 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:51:24,265 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:51:24,267 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:51:24,267 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001705s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:51:24,267 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:51:24,267 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002144s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:51:24,268 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:51:24,268 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002551s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:51:24,268 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:51:24,268 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002963s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:51:24,269 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:51:24,269 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003357s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:51:24,269 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:51:24,772 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:51:24,772 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:51:24,851 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:51:24,932 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:51:24,940 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:51:24,940 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] ()
2024-11-02 22:51:24,941 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:51:25,257 - aiogram.event - feed_update - INFO - Update id=874833227 is handled. Duration 326 ms by bot id=7942268445
2024-11-02 22:51:26,603 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:51:26,604 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 22:51:26,604 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (1,)
2024-11-02 22:51:26,605 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:51:26,705 - aiogram.event - feed_update - INFO - Update id=874833228 is not handled. Duration 102 ms by bot id=7942268445
2024-11-02 22:51:26,705 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833228 by bot id=7942268445
TelegramBadRequest: Telegram server says - Bad Request: there is no text in the message to edit
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 306, in delete_one_item
    await callback.message.edit_text(text=result)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 488, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: there is no text in the message to edit
2024-11-02 22:51:56,676 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:51:56,677 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:51:56,677 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 31.74s ago] ()
2024-11-02 22:51:56,677 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:51:56,943 - aiogram.event - feed_update - INFO - Update id=874833229 is handled. Duration 268 ms by bot id=7942268445
2024-11-02 22:52:53,014 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:52:53,015 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:52:53,015 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:52:53,326 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:52:59,836 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:52:59,886 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:52:59,886 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:52:59,888 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:52:59,888 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:52:59,889 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:52:59,889 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:52:59,889 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:52:59,892 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:52:59,892 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:52:59,893 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:52:59,894 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001991s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:52:59,894 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:52:59,894 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00246s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:52:59,894 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:52:59,894 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002851s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:52:59,895 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:52:59,895 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003242s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:52:59,895 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:52:59,895 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003653s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:52:59,896 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:53:00,255 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:53:00,255 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:53:00,332 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:53:00,427 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:53:00,436 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:53:00,436 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ()
2024-11-02 22:53:00,437 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:53:00,663 - aiogram.event - feed_update - INFO - Update id=874833230 is handled. Duration 237 ms by bot id=7942268445
2024-11-02 22:53:01,852 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:53:01,853 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 22:53:01,853 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (1,)
2024-11-02 22:53:01,854 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:53:01,854 - aiogram.event - feed_update - INFO - Update id=874833231 is not handled. Duration 3 ms by bot id=7942268445
2024-11-02 22:53:01,855 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833231 by bot id=7942268445
AttributeError: 'Message' object has no attribute 'edit_photo'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 306, in delete_one_item
    await callback.message.edit_photo(text=result)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/pydantic/main.py", line 856, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Message' object has no attribute 'edit_photo'. Did you mean: 'reply_photo'?
2024-11-02 22:55:41,099 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:55:41,100 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:55:41,100 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:55:41,340 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:55:47,045 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:55:47,095 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:55:47,095 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:55:47,096 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:55:47,096 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:55:47,097 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:55:47,097 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:55:47,098 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:55:47,100 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:55:47,100 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:55:47,101 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:55:47,101 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001596s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:55:47,102 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:55:47,102 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002016s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:55:47,102 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:55:47,102 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002429s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:55:47,103 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:55:47,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002799s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:55:47,103 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:55:47,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003155s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:55:47,103 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:55:47,474 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:55:47,475 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:55:47,556 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:55:51,636 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:55:51,645 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:55:51,645 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] (859676040,)
2024-11-02 22:55:51,646 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:55:52,022 - aiogram.event - feed_update - INFO - Update id=874833232 is handled. Duration 386 ms by bot id=7942268445
2024-11-02 22:55:52,957 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:55:52,958 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:55:52,958 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ()
2024-11-02 22:55:52,959 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:55:53,144 - aiogram.event - feed_update - INFO - Update id=874833233 is handled. Duration 187 ms by bot id=7942268445
2024-11-02 22:55:53,968 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:55:53,969 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 22:55:53,969 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (1,)
2024-11-02 22:55:53,971 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:55:54,089 - aiogram.event - feed_update - INFO - Update id=874833234 is handled. Duration 121 ms by bot id=7942268445
2024-11-02 22:55:56,356 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:55:56,357 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:55:56,357 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 3.398s ago] ()
2024-11-02 22:55:56,357 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:55:56,511 - aiogram.event - feed_update - INFO - Update id=874833235 is handled. Duration 156 ms by bot id=7942268445
2024-11-02 22:55:57,800 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:55:57,800 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 22:55:57,800 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 3.832s ago] (1,)
2024-11-02 22:55:57,801 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:55:57,895 - aiogram.event - feed_update - INFO - Update id=874833236 is handled. Duration 95 ms by bot id=7942268445
2024-11-02 22:56:02,463 - aiogram.event - feed_update - INFO - Update id=874833237 is handled. Duration 142 ms by bot id=7942268445
2024-11-02 22:56:03,990 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:56:03,990 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 22:56:03,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 12.35s ago] (859676040,)
2024-11-02 22:56:03,991 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:56:04,108 - aiogram.event - feed_update - INFO - Update id=874833238 is handled. Duration 118 ms by bot id=7942268445
2024-11-02 22:56:05,046 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:56:05,046 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:56:05,047 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 12.09s ago] ()
2024-11-02 22:56:05,047 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:56:05,197 - aiogram.event - feed_update - INFO - Update id=874833239 is handled. Duration 152 ms by bot id=7942268445
2024-11-02 22:56:41,187 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 22:56:41,187 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:56:41,187 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 22:56:41,407 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 22:56:48,321 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 22:56:48,369 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 22:56:48,369 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:56:48,370 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 22:56:48,370 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:56:48,370 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 22:56:48,370 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 22:56:48,371 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:56:48,373 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:56:48,373 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:56:48,375 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:56:48,375 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001767s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:56:48,375 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:56:48,375 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002211s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:56:48,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:56:48,376 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002595s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:56:48,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:56:48,376 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002958s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:56:48,376 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 22:56:48,377 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00331s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 22:56:48,377 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 22:56:48,672 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 22:56:48,673 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 22:56:48,733 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 22:56:49,255 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 22:56:49,264 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 22:56:49,264 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ()
2024-11-02 22:56:49,265 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 22:56:49,537 - aiogram.event - feed_update - INFO - Update id=874833240 is handled. Duration 283 ms by bot id=7942268445
2024-11-02 23:00:23,281 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:00:23,281 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:00:23,281 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 214s ago] ()
2024-11-02 23:00:23,281 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:00:23,536 - aiogram.event - feed_update - INFO - Update id=874833241 is handled. Duration 258 ms by bot id=7942268445
2024-11-02 23:00:25,349 - aiogram.event - feed_update - INFO - Update id=874833242 is not handled. Duration 0 ms by bot id=7942268445
2024-11-02 23:00:26,101 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:00:26,102 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 23:00:26,102 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (1,)
2024-11-02 23:00:26,103 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:00:26,199 - aiogram.event - feed_update - INFO - Update id=874833243 is handled. Duration 98 ms by bot id=7942268445
2024-11-02 23:01:08,907 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 23:01:08,907 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 23:01:08,907 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 23:01:09,201 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 23:01:15,382 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 23:01:15,430 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 23:01:15,430 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 23:01:15,430 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 23:01:15,431 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 23:01:15,431 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 23:01:15,431 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 23:01:15,432 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:15,434 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:15,434 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:15,436 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:15,436 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00236s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:15,437 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:15,437 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002785s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:15,437 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:15,437 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003196s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:15,438 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:15,438 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003588s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:15,438 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:15,438 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003976s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:15,438 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:01:15,871 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 23:01:15,871 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 23:01:15,951 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 23:01:21,703 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:21,712 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 23:01:21,713 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00021s] (859676040,)
2024-11-02 23:01:21,714 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:01:22,000 - aiogram.event - feed_update - INFO - Update id=874833244 is handled. Duration 298 ms by bot id=7942268445
2024-11-02 23:01:22,659 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:22,660 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:01:22,660 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ()
2024-11-02 23:01:22,661 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:01:22,782 - aiogram.event - feed_update - INFO - Update id=874833245 is handled. Duration 124 ms by bot id=7942268445
2024-11-02 23:01:23,930 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:23,931 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 23:01:23,931 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (1,)
2024-11-02 23:01:23,932 - sqlalchemy.engine.Engine - _execute_context - INFO - DELETE FROM products WHERE products.id = $1::INTEGER
2024-11-02 23:01:23,933 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] (1,)
2024-11-02 23:01:23,935 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:01:24,055 - aiogram.event - feed_update - INFO - Update id=874833246 is handled. Duration 124 ms by bot id=7942268445
2024-11-02 23:01:26,684 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:26,684 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:01:26,684 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 4.024s ago] ()
2024-11-02 23:01:26,685 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:01:26,787 - aiogram.event - feed_update - INFO - Update id=874833247 is handled. Duration 104 ms by bot id=7942268445
2024-11-02 23:01:48,549 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 23:01:48,549 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 23:01:48,549 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 23:01:48,778 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-02 23:01:54,789 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-02 23:01:54,837 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-02 23:01:54,838 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 23:01:54,838 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-02 23:01:54,839 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 23:01:54,839 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-02 23:01:54,839 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-02 23:01:54,840 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:54,842 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:54,842 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:54,843 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:54,843 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001523s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:54,844 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:54,844 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001906s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:54,844 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:54,844 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002261s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:54,844 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:54,845 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002605s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:54,845 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-02 23:01:54,845 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002944s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-02 23:01:54,845 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:01:55,148 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-02 23:01:55,148 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-02 23:01:55,210 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 23:01:56,189 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:01:56,199 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:01:56,199 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00018s] ()
2024-11-02 23:01:56,201 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:01:56,425 - aiogram.event - feed_update - INFO - Update id=874833248 is handled. Duration 236 ms by bot id=7942268445
2024-11-02 23:04:34,293 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:04:34,294 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 23:04:34,294 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040,)
2024-11-02 23:04:34,295 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:04:34,583 - aiogram.event - feed_update - INFO - Update id=874833249 is handled. Duration 290 ms by bot id=7942268445
2024-11-02 23:04:36,256 - aiogram.event - feed_update - INFO - Update id=874833250 is handled. Duration 131 ms by bot id=7942268445
2024-11-02 23:04:38,003 - aiogram.event - feed_update - INFO - Update id=874833251 is handled. Duration 79 ms by bot id=7942268445
2024-11-02 23:04:42,557 - aiogram.event - feed_update - INFO - Update id=874833252 is handled. Duration 129 ms by bot id=7942268445
2024-11-02 23:04:45,217 - aiogram.event - feed_update - INFO - Update id=874833253 is handled. Duration 110 ms by bot id=7942268445
2024-11-02 23:04:47,887 - aiogram.event - feed_update - INFO - Update id=874833254 is handled. Duration 98 ms by bot id=7942268445
2024-11-02 23:04:55,325 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:04:55,326 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-11-02 23:04:55,326 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] ('Цветок', 'Цветущий', '10.0', 0, True, 'AgACAgIAAxkBAAPKZyZ314ERTIJ2TQdLoMgF83DZdzEAAqj0MRsiKjhJLOCHxSaat6EBAAMCAAN5AAM2BA')
2024-11-02 23:04:55,329 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:04:55,330 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:04:55,331 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-11-02 23:04:55,331 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] ('Цветок',)
2024-11-02 23:04:55,335 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-11-02 23:04:55,335 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] (1, 2)
2024-11-02 23:04:55,335 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:04:55,441 - aiogram.event - feed_update - INFO - Update id=874833255 is handled. Duration 117 ms by bot id=7942268445
2024-11-02 23:04:57,412 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:04:57,412 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 23:04:57,412 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 23.12s ago] (859676040,)
2024-11-02 23:04:57,412 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:04:57,504 - aiogram.event - feed_update - INFO - Update id=874833256 is handled. Duration 93 ms by bot id=7942268445
2024-11-02 23:04:58,627 - aiogram.event - feed_update - INFO - Update id=874833257 is handled. Duration 102 ms by bot id=7942268445
2024-11-02 23:04:59,299 - aiogram.event - feed_update - INFO - Update id=874833258 is handled. Duration 147 ms by bot id=7942268445
2024-11-02 23:05:02,554 - aiogram.event - feed_update - INFO - Update id=874833259 is handled. Duration 160 ms by bot id=7942268445
2024-11-02 23:05:09,192 - aiogram.event - feed_update - INFO - Update id=874833260 is handled. Duration 157 ms by bot id=7942268445
2024-11-02 23:05:11,461 - aiogram.event - feed_update - INFO - Update id=874833261 is handled. Duration 158 ms by bot id=7942268445
2024-11-02 23:05:12,344 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:12,344 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-02 23:05:12,344 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 38.05s ago] (859676040,)
2024-11-02 23:05:12,345 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:05:12,460 - aiogram.event - feed_update - INFO - Update id=874833262 is handled. Duration 116 ms by bot id=7942268445
2024-11-02 23:05:19,289 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:19,289 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-11-02 23:05:19,289 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 23.96s ago] ('Картина', 'Художественная', '100.0', 0, True, 'AgACAgIAAxkBAAPaZyZ371G9Y_fgIcJxeAGRXC_PWyoAAqn0MRsiKjhJFCY3HiFnbg0BAAMCAAN4AAM2BA')
2024-11-02 23:05:19,290 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:05:19,291 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:19,291 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-11-02 23:05:19,291 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 23.96s ago] ('Картина',)
2024-11-02 23:05:19,292 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-11-02 23:05:19,292 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 23.96s ago] (1, 3)
2024-11-02 23:05:19,292 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:05:19,408 - aiogram.event - feed_update - INFO - Update id=874833263 is handled. Duration 119 ms by bot id=7942268445
2024-11-02 23:05:21,235 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:21,236 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:05:21,236 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 205s ago] ()
2024-11-02 23:05:21,236 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:05:21,426 - aiogram.event - feed_update - INFO - Update id=874833264 is handled. Duration 192 ms by bot id=7942268445
2024-11-02 23:05:24,904 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:24,905 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 23:05:24,905 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (3,)
2024-11-02 23:05:24,906 - sqlalchemy.engine.Engine - _execute_context - INFO - DELETE FROM products WHERE products.id = $1::INTEGER
2024-11-02 23:05:24,906 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (3,)
2024-11-02 23:05:24,907 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:05:25,104 - aiogram.event - feed_update - INFO - Update id=874833265 is handled. Duration 201 ms by bot id=7942268445
2024-11-02 23:05:26,345 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:26,345 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:05:26,345 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 210.1s ago] ()
2024-11-02 23:05:26,346 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:05:26,476 - aiogram.event - feed_update - INFO - Update id=874833266 is handled. Duration 132 ms by bot id=7942268445
2024-11-02 23:05:27,494 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:27,494 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.id = $1::INTEGER
2024-11-02 23:05:27,494 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 2.589s ago] (2,)
2024-11-02 23:05:27,495 - sqlalchemy.engine.Engine - _execute_context - INFO - DELETE FROM products WHERE products.id = $1::INTEGER
2024-11-02 23:05:27,495 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 2.589s ago] (2,)
2024-11-02 23:05:27,495 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-02 23:05:27,784 - aiogram.event - feed_update - INFO - Update id=874833267 is handled. Duration 291 ms by bot id=7942268445
2024-11-02 23:05:28,285 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-02 23:05:28,285 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-02 23:05:28,285 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 212.1s ago] ()
2024-11-02 23:05:28,286 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-02 23:05:28,431 - aiogram.event - feed_update - INFO - Update id=874833268 is handled. Duration 146 ms by bot id=7942268445
2024-11-02 23:08:38,028 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-02 23:08:38,028 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-02 23:08:38,028 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-02 23:08:38,275 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 10:56:11,008 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 10:56:11,086 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 10:56:11,086 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:56:11,088 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 10:56:11,088 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:56:11,089 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 10:56:11,089 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:56:11,090 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:56:11,093 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:56:11,093 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:56:11,101 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:56:11,101 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.008226s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:56:11,101 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:56:11,101 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.008778s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:56:11,102 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:56:11,102 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.009216s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:56:11,102 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:56:11,102 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.009662s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:56:11,102 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:56:11,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.01008s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:56:11,103 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:56:11,489 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 10:56:11,489 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 10:56:11,557 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:56:18,707 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:56:18,715 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 10:56:18,715 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] (859676040,)
2024-11-04 10:56:18,719 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:56:19,005 - aiogram.event - feed_update - INFO - Update id=874833269 is handled. Duration 298 ms by bot id=7942268445
2024-11-04 10:56:20,502 - aiogram.event - feed_update - INFO - Update id=874833270 is handled. Duration 87 ms by bot id=7942268445
2024-11-04 10:56:21,504 - aiogram.event - feed_update - INFO - Update id=874833271 is handled. Duration 103 ms by bot id=7942268445
2024-11-04 10:56:28,026 - aiogram.event - feed_update - INFO - Update id=874833272 is handled. Duration 89 ms by bot id=7942268445
2024-11-04 10:56:30,368 - aiogram.event - feed_update - INFO - Update id=874833273 is handled. Duration 111 ms by bot id=7942268445
2024-11-04 10:56:32,372 - aiogram.event - feed_update - INFO - Update id=874833274 is handled. Duration 179 ms by bot id=7942268445
2024-11-04 10:56:37,403 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:56:37,404 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-11-04 10:56:37,405 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('Цветочек', 'Цветущий', '10.0', 0, True, 'AgACAgIAAxkBAAPxZyhwJbbMyU8US5UsbVtOm-jnPJ4AAkLlMRtJqUFJzWwz8ZlLjtcBAAMCAAN5AAM2BA')
2024-11-04 10:56:37,409 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:56:37,410 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:56:37,410 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-11-04 10:56:37,410 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] ('Цветочек',)
2024-11-04 10:56:37,413 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-11-04 10:56:37,413 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (1, 4)
2024-11-04 10:56:37,416 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:56:37,505 - aiogram.event - feed_update - INFO - Update id=874833275 is handled. Duration 103 ms by bot id=7942268445
2024-11-04 10:56:39,237 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:56:39,238 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 10:56:39,238 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 20.52s ago] (859676040,)
2024-11-04 10:56:39,238 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:56:39,331 - aiogram.event - feed_update - INFO - Update id=874833276 is handled. Duration 93 ms by bot id=7942268445
2024-11-04 10:56:40,149 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:56:40,150 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 10:56:40,150 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] ()
2024-11-04 10:56:40,150 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:56:40,244 - aiogram.event - feed_update - INFO - Update id=874833277 is handled. Duration 96 ms by bot id=7942268445
2024-11-04 10:56:41,537 - aiogram.event - feed_update - INFO - Update id=874833278 is not handled. Duration 0 ms by bot id=7942268445
2024-11-04 10:57:01,601 - aiogram.event - feed_update - INFO - Update id=874833279 is not handled. Duration 0 ms by bot id=7942268445
2024-11-04 10:57:43,724 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 10:57:43,725 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:57:43,725 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 10:57:43,973 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 10:57:52,406 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 10:57:52,457 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 10:57:52,457 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:57:52,458 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 10:57:52,458 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:57:52,459 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 10:57:52,459 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:57:52,459 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:57:52,462 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:57:52,462 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00019s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:57:52,464 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:57:52,464 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00181s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:57:52,464 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:57:52,464 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002199s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:57:52,465 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:57:52,465 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002545s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:57:52,465 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:57:52,465 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002919s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:57:52,465 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:57:52,465 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003253s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:57:52,466 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:57:53,123 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 10:57:53,123 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 10:57:53,185 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:57:55,563 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:57:55,571 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 10:57:55,572 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00015s] (859676040,)
2024-11-04 10:57:55,573 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:57:55,796 - aiogram.event - feed_update - INFO - Update id=874833280 is handled. Duration 233 ms by bot id=7942268445
2024-11-04 10:57:56,500 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:57:56,501 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 10:57:56,501 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ()
2024-11-04 10:57:56,502 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:57:56,692 - aiogram.event - feed_update - INFO - Update id=874833281 is handled. Duration 193 ms by bot id=7942268445
2024-11-04 10:57:57,846 - aiogram.event - feed_update - INFO - Update id=874833282 is not handled. Duration 0 ms by bot id=7942268445
2024-11-04 10:58:23,689 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 10:58:23,689 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:58:23,689 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 10:58:24,017 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 10:58:29,844 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 10:58:29,894 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 10:58:29,894 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:58:29,896 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 10:58:29,896 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:58:29,896 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 10:58:29,896 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:58:29,897 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:58:29,900 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:58:29,900 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00020s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:58:29,902 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:58:29,902 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002117s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:58:29,903 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:58:29,903 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002583s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:58:29,903 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:58:29,903 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003025s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:58:29,904 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:58:29,904 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00361s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:58:29,904 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:58:29,905 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.004328s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:58:29,905 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:58:30,274 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 10:58:30,274 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 10:58:30,334 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:58:32,444 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:58:32,452 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 10:58:32,453 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00017s] (859676040,)
2024-11-04 10:58:32,454 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:58:32,682 - aiogram.event - feed_update - INFO - Update id=874833283 is handled. Duration 238 ms by bot id=7942268445
2024-11-04 10:58:33,392 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:58:33,393 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 10:58:33,393 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] ()
2024-11-04 10:58:33,394 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:58:33,510 - aiogram.event - feed_update - INFO - Update id=874833284 is handled. Duration 119 ms by bot id=7942268445
2024-11-04 10:58:34,318 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:58:34,319 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO shopping_cart (user_id, product_id, quantity) VALUES ($1::INTEGER, $2::INTEGER, $3::INTEGER) RETURNING shopping_cart.id
2024-11-04 10:58:34,319 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (859676040, '4', 1)
2024-11-04 10:58:34,320 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:58:34,321 - aiogram.event - feed_update - INFO - Update id=874833285 is not handled. Duration 3 ms by bot id=7942268445
2024-11-04 10:58:34,321 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833285 by bot id=7942268445
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '4' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO shopping_cart (user_id, product_id, quantity) VALUES ($1::INTEGER, $2::INTEGER, $3::INTEGER) RETURNING shopping_cart.id]
[parameters: (859676040, '4', 1)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 54, in asyncpg.pgproto.pgproto.int4_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: '4' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '4' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 313, in item_to_cart
    result = await add_to_cart(user_id=user_id,
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 303, in add_to_cart
    await session.commit()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '4' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO shopping_cart (user_id, product_id, quantity) VALUES ($1::INTEGER, $2::INTEGER, $3::INTEGER) RETURNING shopping_cart.id]
[parameters: (859676040, '4', 1)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2024-11-04 10:59:18,099 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 10:59:18,099 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:59:18,100 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 10:59:18,405 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 10:59:24,471 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 10:59:24,524 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 10:59:24,524 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:59:24,525 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 10:59:24,525 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:59:24,526 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 10:59:24,526 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 10:59:24,527 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:59:24,529 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:59:24,529 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:59:24,531 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:59:24,531 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001727s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:59:24,531 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:59:24,531 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002146s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:59:24,532 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:59:24,532 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002531s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:59:24,532 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:59:24,532 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002926s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:59:24,532 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 10:59:24,532 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003326s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 10:59:24,533 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:59:24,869 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 10:59:24,869 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 10:59:24,934 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 10:59:25,602 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:59:25,611 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 10:59:25,611 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ()
2024-11-04 10:59:25,612 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 10:59:25,837 - aiogram.event - feed_update - INFO - Update id=874833286 is handled. Duration 236 ms by bot id=7942268445
2024-11-04 10:59:26,683 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 10:59:26,684 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO shopping_cart (user_id, product_id, quantity) VALUES ($1::INTEGER, $2::INTEGER, $3::INTEGER) RETURNING shopping_cart.id
2024-11-04 10:59:26,684 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (859676040, 4, 1)
2024-11-04 10:59:26,686 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 10:59:26,778 - aiogram.event - feed_update - INFO - Update id=874833287 is handled. Duration 95 ms by bot id=7942268445
2024-11-04 11:00:38,559 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 11:00:38,559 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:00:38,559 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 11:00:38,774 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 11:02:52,932 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 11:02:52,982 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 11:02:52,982 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:02:52,983 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 11:02:52,983 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:02:52,983 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 11:02:52,983 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:02:52,984 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:02:52,986 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:02:52,986 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:02:52,988 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:02:52,988 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001592s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:02:52,988 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:02:52,988 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001995s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:02:52,988 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:02:52,988 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00237s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:02:52,989 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:02:52,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002738s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:02:52,989 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:02:52,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003095s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:02:52,990 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE order_items
2024-11-04 11:02:52,990 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-11-04 11:02:52,998 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE balances
2024-11-04 11:02:52,998 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-11-04 11:02:52,999 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE orders
2024-11-04 11:02:52,999 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-11-04 11:02:52,999 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE shopping_cart
2024-11-04 11:02:52,999 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-11-04 11:02:53,000 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE products
2024-11-04 11:02:53,000 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-11-04 11:02:53,002 - sqlalchemy.engine.Engine - _execute_context - INFO - 
DROP TABLE users
2024-11-04 11:02:53,002 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00006s] ()
2024-11-04 11:02:53,003 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:02:53,422 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 11:02:53,422 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 11:02:53,511 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:02:53,990 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 11:02:53,991 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:02:53,991 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 11:02:54,198 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 11:26:13,816 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 11:26:13,866 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 11:26:13,867 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:26:13,868 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 11:26:13,868 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:26:13,868 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 11:26:13,868 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:26:13,869 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:13,871 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:26:13,871 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:26:13,873 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:26:13,873 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001697s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:26:13,873 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:26:13,873 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.00212s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:26:13,874 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:26:13,874 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002536s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:26:13,874 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:26:13,874 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002965s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:26:13,875 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:26:13,875 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003317s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:26:13,875 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE users (
	tg_id SERIAL NOT NULL, 
	referal_code VARCHAR NOT NULL, 
	referred_by INTEGER, 
	PRIMARY KEY (tg_id), 
	UNIQUE (referal_code), 
	FOREIGN KEY(referred_by) REFERENCES users (tg_id)
)


2024-11-04 11:26:13,875 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00007s] ()
2024-11-04 11:26:13,890 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE products (
	id SERIAL NOT NULL, 
	product_name VARCHAR(100) NOT NULL, 
	description VARCHAR, 
	price DECIMAL(10, 2) NOT NULL, 
	amount INTEGER NOT NULL, 
	is_stock BOOLEAN, 
	photo_id VARCHAR NOT NULL, 
	PRIMARY KEY (id)
)


2024-11-04 11:26:13,890 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00012s] ()
2024-11-04 11:26:13,894 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE shopping_cart (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	product_id INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-11-04 11:26:13,894 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-11-04 11:26:13,896 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE orders (
	id SERIAL NOT NULL, 
	user_id INTEGER, 
	date_order TIMESTAMP WITHOUT TIME ZONE, 
	status VARCHAR, 
	total_price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-11-04 11:26:13,896 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-11-04 11:26:13,900 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE balances (
	user_id INTEGER NOT NULL, 
	quantity DECIMAL(10, 2), 
	PRIMARY KEY (user_id), 
	FOREIGN KEY(user_id) REFERENCES users (tg_id)
)


2024-11-04 11:26:13,900 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00009s] ()
2024-11-04 11:26:13,902 - sqlalchemy.engine.Engine - _execute_context - INFO - 
CREATE TABLE order_items (
	id SERIAL NOT NULL, 
	order_id INTEGER, 
	product_id INTEGER, 
	quantity INTEGER NOT NULL, 
	price DECIMAL(10, 2) NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(order_id) REFERENCES orders (id), 
	FOREIGN KEY(product_id) REFERENCES products (id)
)


2024-11-04 11:26:13,902 - sqlalchemy.engine.Engine - _execute_context - INFO - [no key 0.00010s] ()
2024-11-04 11:26:13,905 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:26:14,250 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 11:26:14,250 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 11:26:14,320 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:26:16,719 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:16,727 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:26:16,727 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] (859676040,)
2024-11-04 11:26:16,728 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:26:16,729 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:16,730 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO users (tg_id, referal_code, referred_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::INTEGER)
2024-11-04 11:26:16,730 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (859676040, 'LM5O63IK', None)
2024-11-04 11:26:16,731 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO balances (user_id, quantity) VALUES ($1::INTEGER, $2::NUMERIC(10, 2))
2024-11-04 11:26:16,731 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] (859676040, 0.0)
2024-11-04 11:26:16,731 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:26:17,027 - aiogram.event - feed_update - INFO - Update id=874833288 is handled. Duration 309 ms by bot id=7942268445
2024-11-04 11:26:21,157 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:21,157 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:26:21,157 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 4.43s ago] (859676040,)
2024-11-04 11:26:21,158 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:26:21,528 - aiogram.event - feed_update - INFO - Update id=874833289 is handled. Duration 373 ms by bot id=7942268445
2024-11-04 11:26:22,639 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:22,640 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 11:26:22,640 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] ()
2024-11-04 11:26:22,641 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:26:22,739 - aiogram.event - feed_update - INFO - Update id=874833290 is handled. Duration 101 ms by bot id=7942268445
2024-11-04 11:26:24,238 - aiogram.event - feed_update - INFO - Update id=874833291 is handled. Duration 100 ms by bot id=7942268445
2024-11-04 11:26:24,572 - aiogram.event - feed_update - INFO - Update id=874833292 is handled. Duration 86 ms by bot id=7942268445
2024-11-04 11:26:28,029 - aiogram.event - feed_update - INFO - Update id=874833293 is handled. Duration 84 ms by bot id=7942268445
2024-11-04 11:26:31,536 - aiogram.event - feed_update - INFO - Update id=874833294 is handled. Duration 89 ms by bot id=7942268445
2024-11-04 11:26:33,117 - aiogram.event - feed_update - INFO - Update id=874833295 is handled. Duration 77 ms by bot id=7942268445
2024-11-04 11:26:37,810 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:37,811 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-11-04 11:26:37,811 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('Цветочек', 'Цветущий', '10.0', 0, True, 'AgACAgIAAxkBAAPxZyhwJbbMyU8US5UsbVtOm-jnPJ4AAkLlMRtJqUFJzWwz8ZlLjtcBAAMCAAN5AAM2BA')
2024-11-04 11:26:37,812 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:26:37,813 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:37,814 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-11-04 11:26:37,814 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] ('Цветочек',)
2024-11-04 11:26:37,815 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-11-04 11:26:37,815 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00011s] (1, 1)
2024-11-04 11:26:37,816 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:26:37,901 - aiogram.event - feed_update - INFO - Update id=874833296 is handled. Duration 91 ms by bot id=7942268445
2024-11-04 11:26:41,334 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:41,334 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:26:41,334 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 24.61s ago] (859676040,)
2024-11-04 11:26:41,335 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:26:41,433 - aiogram.event - feed_update - INFO - Update id=874833297 is handled. Duration 99 ms by bot id=7942268445
2024-11-04 11:26:42,103 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:42,103 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 11:26:42,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 19.46s ago] ()
2024-11-04 11:26:42,104 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:26:42,192 - aiogram.event - feed_update - INFO - Update id=874833298 is handled. Duration 89 ms by bot id=7942268445
2024-11-04 11:26:43,466 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:26:43,467 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO shopping_cart (user_id, product_id) VALUES ($1::INTEGER, $2::INTEGER) RETURNING shopping_cart.id
2024-11-04 11:26:43,467 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040, 1)
2024-11-04 11:26:43,469 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:26:43,654 - aiogram.event - feed_update - INFO - Update id=874833299 is handled. Duration 188 ms by bot id=7942268445
2024-11-04 11:26:45,184 - aiogram.event - feed_update - INFO - Update id=874833300 is not handled. Duration 1 ms by bot id=7942268445
2024-11-04 11:26:45,184 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833300 by bot id=7942268445
AttributeError: 'coroutine' object has no attribute 'scalars'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 322, in get_cart
    products = await get_user_cart(user_id=user_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 326, in get_user_cart
    result = session.execute(request).scalars().all()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'scalars'
2024-11-04 11:27:32,980 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 11:27:32,980 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:27:32,980 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 11:27:33,286 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 11:27:40,285 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 11:27:40,334 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 11:27:40,334 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:27:40,335 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 11:27:40,335 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:27:40,336 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 11:27:40,336 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:27:40,336 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:27:40,339 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:27:40,339 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:27:40,340 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:27:40,340 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001611s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:27:40,341 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:27:40,341 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001994s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:27:40,341 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:27:40,341 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002458s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:27:40,341 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:27:40,341 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002811s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:27:40,342 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:27:40,342 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003149s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:27:40,342 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:27:40,667 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 11:27:40,668 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 11:27:40,737 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:27:41,334 - aiogram.event - feed_update - INFO - Update id=874833301 is not handled. Duration 2 ms by bot id=7942268445
2024-11-04 11:27:41,334 - aiogram.event - _process_update - ERROR - Cause exception while process update id=874833301 by bot id=7942268445
AttributeError: 'coroutine' object has no attribute 'scalars'
Traceback (most recent call last):
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/handlers/handler.py", line 322, in get_cart
    products = await get_user_cart(user_id=user_id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/turra7/Рабочий стол/BotShop/core/database/dataTools.py", line 326, in get_user_cart
    result = await session.execute(request).scalars().all()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'coroutine' object has no attribute 'scalars'
2024-11-04 11:28:29,043 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 11:28:29,043 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:28:29,043 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 11:28:29,226 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 11:28:34,936 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 11:28:34,985 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 11:28:34,985 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:28:34,986 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 11:28:34,986 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:28:34,986 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 11:28:34,987 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:28:34,987 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:28:34,989 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:28:34,989 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00013s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:28:34,991 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:28:34,991 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001529s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:28:34,991 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:28:34,991 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002029s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:28:34,992 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:28:34,992 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002458s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:28:34,992 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:28:34,992 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002881s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:28:34,993 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:28:34,993 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003288s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:28:34,993 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:28:35,259 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 11:28:35,259 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 11:28:35,316 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:28:35,643 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:28:35,651 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products JOIN shopping_cart ON products.id = shopping_cart.product_id 
WHERE shopping_cart.user_id = $1::INTEGER
2024-11-04 11:28:35,651 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00019s] (859676040,)
2024-11-04 11:28:35,653 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:28:35,938 - aiogram.event - feed_update - INFO - Update id=874833302 is handled. Duration 297 ms by bot id=7942268445
2024-11-04 11:29:06,124 - aiogram.event - feed_update - INFO - Update id=874833303 is handled. Duration 259 ms by bot id=7942268445
2024-11-04 11:29:07,749 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 11:29:07,749 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:29:07,749 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 11:29:07,845 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
2024-11-04 11:29:13,527 - asyncio - __init__ - DEBUG - Using selector: EpollSelector
2024-11-04 11:29:13,583 - sqlalchemy.engine.Engine - _execute_context - INFO - select pg_catalog.version()
2024-11-04 11:29:13,583 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:29:13,584 - sqlalchemy.engine.Engine - _execute_context - INFO - select current_schema()
2024-11-04 11:29:13,584 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:29:13,585 - sqlalchemy.engine.Engine - _execute_context - INFO - show standard_conforming_strings
2024-11-04 11:29:13,585 - sqlalchemy.engine.Engine - _execute_context - INFO - [raw sql] ()
2024-11-04 11:29:13,585 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:29:13,588 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:29:13,588 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:29:13,589 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:29:13,589 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.001709s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:29:13,590 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:29:13,590 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002141s ago] ('shopping_cart', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:29:13,590 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:29:13,590 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002533s ago] ('orders', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:29:13,591 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:29:13,591 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.002972s ago] ('order_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:29:13,591 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2024-11-04 11:29:13,591 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 0.003386s ago] ('balances', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2024-11-04 11:29:13,591 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:29:13,951 - core.handlers.handler - start_bot - INFO - Бот запущен!
2024-11-04 11:29:13,952 - aiogram.dispatcher - start_polling - INFO - Start polling
2024-11-04 11:29:14,019 - aiogram.dispatcher - _polling - INFO - Run polling for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:29:14,095 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:29:14,103 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:29:14,103 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00016s] (859676040,)
2024-11-04 11:29:14,104 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:29:14,301 - aiogram.event - feed_update - INFO - Update id=874833304 is handled. Duration 206 ms by bot id=7942268445
2024-11-04 11:29:15,190 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:29:15,191 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products JOIN shopping_cart ON products.id = shopping_cart.product_id 
WHERE shopping_cart.user_id = $1::INTEGER
2024-11-04 11:29:15,191 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] (859676040,)
2024-11-04 11:29:15,193 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:29:15,278 - aiogram.event - feed_update - INFO - Update id=874833305 is handled. Duration 90 ms by bot id=7942268445
2024-11-04 11:29:39,358 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:29:39,358 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:29:39,358 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 25.26s ago] (859676040,)
2024-11-04 11:29:39,359 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:29:39,603 - aiogram.event - feed_update - INFO - Update id=874833306 is handled. Duration 245 ms by bot id=7942268445
2024-11-04 11:29:40,742 - aiogram.event - feed_update - INFO - Update id=874833307 is handled. Duration 138 ms by bot id=7942268445
2024-11-04 11:29:41,371 - aiogram.event - feed_update - INFO - Update id=874833308 is handled. Duration 200 ms by bot id=7942268445
2024-11-04 11:29:47,315 - aiogram.event - feed_update - INFO - Update id=874833309 is handled. Duration 150 ms by bot id=7942268445
2024-11-04 11:29:52,134 - aiogram.event - feed_update - INFO - Update id=874833310 is handled. Duration 219 ms by bot id=7942268445
2024-11-04 11:29:56,258 - aiogram.event - feed_update - INFO - Update id=874833311 is handled. Duration 99 ms by bot id=7942268445
2024-11-04 11:30:00,068 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:00,070 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-11-04 11:30:00,070 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00014s] ('Картина красотки', 'Сделанна AI', '100000.0', 0, True, 'AgACAgIAAxkBAAIBPmcod_dSFP0xI6ntMEzuoltdWUTBAAJ_5TEbSalBSRA7euA-XdNFAQADAgADeQADNgQ')
2024-11-04 11:30:00,071 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:30:00,072 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:00,073 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-11-04 11:30:00,073 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00008s] ('Картина красотки',)
2024-11-04 11:30:00,074 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-11-04 11:30:00,074 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00010s] (1, 2)
2024-11-04 11:30:00,075 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:30:00,173 - aiogram.event - feed_update - INFO - Update id=874833312 is handled. Duration 105 ms by bot id=7942268445
2024-11-04 11:30:10,068 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:10,069 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:30:10,069 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 55.97s ago] (859676040,)
2024-11-04 11:30:10,069 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:30:10,167 - aiogram.event - feed_update - INFO - Update id=874833313 is handled. Duration 99 ms by bot id=7942268445
2024-11-04 11:30:11,692 - aiogram.event - feed_update - INFO - Update id=874833314 is handled. Duration 113 ms by bot id=7942268445
2024-11-04 11:30:12,064 - aiogram.event - feed_update - INFO - Update id=874833315 is handled. Duration 146 ms by bot id=7942268445
2024-11-04 11:30:20,290 - aiogram.event - feed_update - INFO - Update id=874833316 is handled. Duration 162 ms by bot id=7942268445
2024-11-04 11:30:25,604 - aiogram.event - feed_update - INFO - Update id=874833317 is handled. Duration 87 ms by bot id=7942268445
2024-11-04 11:30:27,411 - aiogram.event - feed_update - INFO - Update id=874833318 is handled. Duration 96 ms by bot id=7942268445
2024-11-04 11:30:32,045 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:32,045 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO products (product_name, description, price, amount, is_stock, photo_id) VALUES ($1::VARCHAR, $2::VARCHAR, $3::NUMERIC(10, 2), $4::INTEGER, $5::BOOLEAN, $6::VARCHAR) RETURNING products.id
2024-11-04 11:30:32,045 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 31.98s ago] ('Пейзажи', 'Красивые', '100.0', 0, True, 'AgACAgIAAxkBAAIBTGcoeBdRYBHwGohyy5dYS4iJXN-sAAKA5TEbSalBScl6vSE4YeZRAQADAgADeQADNgQ')
2024-11-04 11:30:32,046 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:30:32,047 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:32,047 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products 
WHERE products.product_name = $1::VARCHAR
2024-11-04 11:30:32,047 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 31.97s ago] ('Пейзажи',)
2024-11-04 11:30:32,048 - sqlalchemy.engine.Engine - _execute_context - INFO - UPDATE products SET amount=$1::INTEGER WHERE products.id = $2::INTEGER
2024-11-04 11:30:32,048 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 31.97s ago] (1, 3)
2024-11-04 11:30:32,048 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:30:32,245 - aiogram.event - feed_update - INFO - Update id=874833319 is handled. Duration 201 ms by bot id=7942268445
2024-11-04 11:30:33,780 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:33,781 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT users.tg_id, users.referal_code, users.referred_by 
FROM users 
WHERE users.tg_id = $1::INTEGER
2024-11-04 11:30:33,781 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 79.68s ago] (859676040,)
2024-11-04 11:30:33,781 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:30:33,877 - aiogram.event - feed_update - INFO - Update id=874833320 is handled. Duration 96 ms by bot id=7942268445
2024-11-04 11:30:34,777 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:34,778 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products
2024-11-04 11:30:34,778 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00009s] ()
2024-11-04 11:30:34,779 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:30:35,032 - aiogram.event - feed_update - INFO - Update id=874833321 is handled. Duration 255 ms by bot id=7942268445
2024-11-04 11:30:37,077 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:37,077 - sqlalchemy.engine.Engine - _execute_context - INFO - INSERT INTO shopping_cart (user_id, product_id) VALUES ($1::INTEGER, $2::INTEGER) RETURNING shopping_cart.id
2024-11-04 11:30:37,077 - sqlalchemy.engine.Engine - _execute_context - INFO - [generated in 0.00012s] (859676040, 3)
2024-11-04 11:30:37,079 - sqlalchemy.engine.Engine - _connection_commit_impl - INFO - COMMIT
2024-11-04 11:30:37,228 - aiogram.event - feed_update - INFO - Update id=874833322 is handled. Duration 151 ms by bot id=7942268445
2024-11-04 11:30:38,583 - sqlalchemy.engine.Engine - _connection_begin_impl - INFO - BEGIN (implicit)
2024-11-04 11:30:38,583 - sqlalchemy.engine.Engine - _execute_context - INFO - SELECT products.id, products.product_name, products.description, products.price, products.amount, products.is_stock, products.photo_id 
FROM products JOIN shopping_cart ON products.id = shopping_cart.product_id 
WHERE shopping_cart.user_id = $1::INTEGER
2024-11-04 11:30:38,583 - sqlalchemy.engine.Engine - _execute_context - INFO - [cached since 83.39s ago] (859676040,)
2024-11-04 11:30:38,584 - sqlalchemy.engine.Engine - _connection_rollback_impl - INFO - ROLLBACK
2024-11-04 11:30:38,895 - aiogram.event - feed_update - INFO - Update id=874833323 is handled. Duration 314 ms by bot id=7942268445
2024-11-04 11:31:50,357 - aiogram.dispatcher - _signal_stop_polling - WARNING - Received SIGINT signal
2024-11-04 11:31:50,357 - aiogram.dispatcher - _polling - INFO - Polling stopped for bot @ShopTraningBot id=7942268445 - 'ShopBotTraning'
2024-11-04 11:31:50,357 - aiogram.dispatcher - start_polling - INFO - Polling stopped
2024-11-04 11:31:50,668 - core.handlers.handler - stop_bot - INFO - Бот остановлен!
